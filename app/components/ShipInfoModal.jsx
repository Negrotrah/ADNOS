'use client';

import { useEffect, useRef, useState } from 'react';
import { createPortal } from 'react-dom';
import styles from './ShipInfoModal.module.css';
import dynamic from 'next/dynamic';

// Импорт компонента SectorsMap с отключенным SSR
const SectorsMap = dynamic(() => import('./SectorsMap'), { 
  ssr: false,
  loading: () => (
    <div className={styles.loadingMap}>
      <div className={styles.loadingText}>LOADING SECTORS MAP...</div>
    </div>
  )
});

// Список разрешенных звезд для псевдо-идентификатора
const ALLOWED_PSEUDO_STARS = [
  'Псевдо Альфа Центавра',
  'Псевдо Сириус',
  'Псевдо Вега',
  'Псевдо Бетельгейзе',
  'Псевдо Проксима Центавра',
  'Псевдо Полярная звезда',
  'Псевдо Антарес',
  'Псевдо Альдебаран',
  'Псевдо Альтаир',
  'Псевдо Спика',
  'Псевдо Ригель',
  'Псевдо Арктур',
  'Псевдо Процион',
  'Псевдо Фомальгаут',
  'Псевдо Денеб',
  'Псевдо Регул',
  'Псевдо Капелла',
  'Псевдо UY Щита',
  'Псевдо TRAPPIST-1',
  'Псевдо Канопус'
];

// Импортируем данные о секторах из существующего компонента
const sectorsData = [
  { 
    id: '12-A', 
    name: 'Сектор 12-A', 
    type: 'anomalous', 
    description: 'Смотреть в разделе сектора 12-A',
    status: 'Исследуется',
    fullDescription: 'Подробная информация в разделе SECTOR 12-A'
  },
  { 
    id: '11-B', 
    name: 'Сектор 11-B', 
    type: 'explored',
    description: 'Картографирован в 2181 году. Содержит 3 звездные системы с кислородными планетами. Представляет интерес для колонизации.',
    status: 'Исследован на 94%',
    fullDescription: 'Сектор 11-B, картографированный в 2181 году, — это жемчужина космоса, манящая исследователей и колонистов. Он включает три звёздные системы, каждая с кислородными планетами, чьи атмосферы шепчут о возможной жизни. Золотистые небеса планеты Аурелии, крупнейшей в секторе, переливаются из-за редких минералов в её коре, создавая гипнотические закаты. Вторая система, Ксавир, окутана тайной: её планета покрыта густыми джунглями, где сенсоры фиксируют странные биологические сигналы, но экспедиции пока не вернулись с ответами. Третья система, Эридан, славится своими кольцевыми архипелагами на водной планете, идеальными для строительства плавучих мегаполисов.\n\nСектор 11-B — это надежда человечества на новый дом, но его богатства охраняются суровыми условиями: частые ионные бури и непредсказуемые гравитационные аномалии усложняют навигацию. Колониальные корпорации уже соперничают за права на разработку, а слухи о древних артефактах, спрятанных в недрах Аурелии, привлекают искателей приключений. Здесь каждый шаг — это риск и возможность.\n\nСвязи:\nС 10-C: Транзитные маршруты 10-C доставляют колонистов и материалы в 11-B, но корабли с минералами Аурелии часто атакуются грабителями.\nС 13-B: Контрабандисты из 13-B крадут минералы и артефакты с Аурелии (11-B), создавая напряжённость с колониальными властями.\nС 14-A: Опорный Пункт II в 14-A обслуживает экспедиции в 11-B, но высокие цены "Гелиос-Тех" вызывают недовольство колонистов.\nС 9-D: Редкие металлы из 9-D поставляются в 11-B для строительства баз, но транспортировка через опасные маршруты привлекает пиратов.'
  },
  { 
    id: '13-B', 
    name: 'Сектор 13-B', 
    type: 'restricted',
    description: 'Ограниченный доступ. Аномальная активность пространственно-временного континуума. Требуется разрешение Nex-11.',
    status: 'Запрещённая зона',
    fullDescription: 'Сектор 13-B — безопасная с точки зрения природы зона, но рассадник преступности. Навигация затруднена из-за помех, картография неполная. Здесь орудуют пираты, контрабандисты и синдикаты, вроде "Serpent Ring Cartel". Орбитальные станции, такие как "Кровавая Спайка", — центры чёрного рынка, где торгуют всем: от ксеноминералов до краденых данных. Планеты — пустыни или токсичные болота, где прячутся бандитские базы. В астероидных поясах находят обломки старых кораблей, возможно, древних.\n\nХодят слухи о "Маяке" — станции, где продают любые секреты за огромные деньги. В 13-B правят сделки и предательство.\n\nСвязи:\nС 11-B: Контрабандисты из 13-B крадут минералы с Аурелии (11-B) и переправляют их через "Кровавую Спайку" на чёрный рынок, вызывая конфликты с колонистами.\nС 18-A: "Аванпост Кси" в 18-A ведёт охоту на контрабандистов 13-B, что приводит к стычкам на границах и попыткам пиратов обойти патрули.\nС 19-C: Контрабандисты из 13-B вывозят артефакты из 19-C, нарушая карантин, и торгуют ими на "Кровавой Спайке".\nС 17-D: Астероидные поля 17-D служат тайными укрытиями для баз и складов синдикатов 13-B, где они прячут краденые грузы.'
  },
  { 
    id: '10-C', 
    name: 'Сектор 10-C', 
    type: 'registered',
    description: 'Сектор регулярно используется для транзитных перелётов. Не представляет научного интереса.',
    status: 'Транзитный',
    fullDescription: 'Сектор 10-C — оживлённый космический коридор, используемый для транзитных перелётов между крупными системами. Его звёздные карты хорошо изучены, а стабильные гиперпространственные маршруты делают его основным узлом для торговых караванов и пассажирских лайнеров. В секторе нет планет, пригодных для жизни, только несколько газовых гигантов и астероидные поля с низкоценными минералами. Научного интереса он не представляет: ни аномалий, ни следов древних цивилизаций.\n\nГлавная достопримечательность — орбитальная станция "Транзит-7", где заправляются корабли и заключаются торговые сделки. Однако из-за большого потока транспорта сектор привлекает мелких грабителей, которые устраивают засады в астероидных поясах.\n\nСвязи:\nС 11-B: Транзитные маршруты 10-C доставляют колонистов и оборудование в 11-B, но грузы с минералами Аурелии привлекают пиратов из астероидных поясов 10-C.\nС 18-A: Военная станция "Аванпост Кси" в 18-A патрулирует 10-C, чтобы защитить торговые караваны от грабителей, но проверки задерживают рейсы.\nС 15-B: Сектор 15-B служит тестовой зоной для кораблей из 10-C, калибрующих навигацию перед сложными маршрутами через "Транзит-7".\nС 20-D: Корабли из 10-C используют торговую станцию "Нексус-5" в 20-D как перевалочный пункт для заправки и обмена грузами.'
  },
  { 
    id: '14-A', 
    name: 'Сектор 14-A', 
    type: 'registered',
    description: 'Содержит Опорный Пункт II - станцию технического обслуживания исследовательских кораблей.',
    status: 'Зарегистрирован',
    fullDescription: 'Сектор 14-A — стратегически важный узел, центром которого является Опорный Пункт II, крупная станция технического обслуживания для исследовательских кораблей. Станция оснащена доками для ремонта, складами запчастей и лабораториями для анализа собранных данных. Сектор сам по себе малопримечателен: пара звёзд с небольшими планетами, покрытыми льдом или камнем, и несколько метеоритных полей.\n\nОднако Опорный Пункт II делает 14-A ключевым для экспедиций в дальние регионы, обеспечивая топливо, ремонт и временный приют. Станция строго контролируется корпорацией "Helios-Tech", и доступ ограничен для неавторизованных судов. Ходят слухи, что на пункте проводят секретные эксперименты с ксено-технологиями, но официально это лишь "технический хаб".\n\nСвязи:\nС 11-B: Опорный Пункт II обслуживает корабли, направляющиеся в 11-B для колонизации или исследований. Некоторые экипажи жалуются, что "Helios-Tech" завышает цены за ремонт для экспедиций на Аурелию.\nС 13-B: Контрабандисты из 13-B пытаются проникнуть на Опорный Пункт II, чтобы украсть запчасти или данные, что заставляет станцию усиливать охрану.\nС 10-C: Транзитные корабли из 10-C часто делают остановку в 14-A для дозаправки перед дальними рейсами, создавая поток грузов, который иногда используют для нелегальных сделок.'
  },
  { 
    id: '9-D', 
    name: 'Сектор 9-D', 
    type: 'explored',
    description: 'Богат ресурсами. Отмечен для промышленного освоения. Содержит значительные залежи редких металлов.',
    status: 'Исследован',
    fullDescription: 'Сектор 9-D — промышленный кладезь, богатый ресурсами, особенно редкими металлами, такими как тританиум и осмирий, критически важными для строительства гиперпространственных двигателей и брони космических кораблей. Сектор включает несколько звёздных систем с планетами, чьи коры изобилуют рудными жилами, и астероидные пояса, усеянные ценными обломками. Крупнейшая планета, Феррон, — суровый мир с вулканической активностью, но её недра содержат крупнейшие залежи.\n\nСектор отмечен для промышленного освоения, и корпорации вроде "Nova-Mine" уже разворачивают добывающие платформы. Однако высокая радиация и нестабильные магнитные поля осложняют работу, а частые нападения дронов-охранников, предположительно оставленных древней цивилизацией, угрожают шахтёрским командам.\n\nСвязи:\nС 11-B: Редкие металлы из 9-D используются для строительства колониальных баз в 11-B, но транспортировка через опасные маршруты привлекает пиратов.\nС 13-B: Контрабандисты 13-B крадут металлы из 9-D, перепродавая их на чёрном рынке, что вызывает конфликты с "Nova-Mine".\nС 10-C: Грузы с металлами из 9-D проходят через транзитные маршруты 10-C, увеличивая риск нападений грабителей в астероидных поясах.\nС 14-A: Опорный Пункт II в 14-A ремонтирует повреждённые добывающие корабли из 9-D, а "Helios-Tech" пытается получить доступ к данным о древних дронах.'
  },
  { 
    id: '15-B', 
    name: 'Сектор 15-B', 
    type: 'registered', 
    description: 'Транзитный сектор с умеренной звездной плотностью. Используется для калибровки навигационных систем.', 
    status: 'Зарегистрирован',
    fullDescription: 'Сектор 15-B — транзитный регион с умеренной звёздной плотностью, идеальный для калибровки навигационных систем космических кораблей. Его стабильные звёздные поля и минимальные гравитационные аномалии делают сектор эталонным для настройки гиперпространственных маяков. В секторе нет обитаемых планет, только несколько малых астероидов и газовых облаков.\n\nОсновной объект — автоматическая станция "Орион-К", которая передаёт сигналы для синхронизации навигационного оборудования. Сектор малопривлекателен для исследований или добычи, но его безопасность и предсказуемость делают его популярным среди пилотов, тестирующих новые маршруты. Иногда станция "Орион-К" становится целью хакеров, пытающихся перенастроить сигналы для срыва транзитных рейсов.\n\nСвязи:\nС 10-C: Сектор 15-B часто используется как "тестовая площадка" для кораблей, следующих через транзитные маршруты 10-C, чтобы проверить навигацию перед сложными рейсами.\nС 14-A: Опорный Пункт II в 14-A обслуживает корабли, калибрующие системы в 15-B, и поставляет обновления для станции "Орион-К".\nС 13-B: Хакеры из 13-B пытаются взломать "Орион-К" в 15-B, чтобы сбивать с курса торговые корабли и облегчать пиратские налёты в других секторах.'
  },
  { 
    id: '16-C', 
    name: 'Сектор 16-C', 
    type: 'restricted', 
    description: 'Ограниченный доступ. В секторе проводятся эксперименты с квантовыми структурами вне юридической зоны конвенций.', 
    status: 'Закрытый сектор',
    fullDescription: 'Сектор 16-C — зона строгого доступа, закрытая для большинства кораблей из-за секретных экспериментов с квантовыми структурами, проводимых вне рамок галактических конвенций. Сектор включает одну звёздную систему с небольшой планетой, чья орбита окружена сетью орбитальных лабораторий, управляемых консорциумом "Quantum-Ark". Эти лаборатории изучают квантовые аномалии, способные изменить пространство-время или создать новые виды энергии.\n\nДанные о результатах засекречены, но утечки говорят о нестабильных прототипах, вызывающих локальные искажения. Сектор патрулируется автономными дронами, а несанкционированный вход карается немедленным уничтожением. Поговаривают, что "Quantum-Ark" сотрудничает с теневыми фигурами, чтобы продавать технологии на чёрном рынке.\n\nСвязи:\nС 13-B: Теневые дельцы из 13-B торгуют украденными данными экспериментов 16-C, что делает сектор мишенью для хакеров и контрабандистов.\nС 14-A: Опорный Пункт II в 14-A тайно обслуживает корабли "Quantum-Ark" из 16-C, несмотря на официальный запрет, что вызывает подозрения в коррупции.\nС 15-B: Эксперименты в 16-C иногда мешают сигналам станции "Орион-К" в 15-B, сбивая навигацию транзитных кораблей.'
  },
  { 
    id: '8-A', 
    name: 'Сектор 8-A', 
    type: 'explored', 
    description: 'Исследован в 2174. Примечательные объекты: система двойных нейтронных звезд B-99.', 
    status: 'Изучен полностью',
    fullDescription: 'Сектор 8-A, исследованный в 2174 году, выделяется системой двойных нейтронных звёзд B-99, чьё гравитационное взаимодействие создаёт редкие энергетические всплески, привлекающие учёных. Сектор не имеет обитаемых планет, только обломки астероидов и газовые облака, насыщенные тяжёлыми элементами. B-99 служит естественной лабораторией для изучения физики высоких энергий, но её мощные излучения делают исследования рискованными.\n\nНебольшая научная станция "Пульсар-4" на орбите собирает данные, но её экипаж сталкивается с частыми сбоями оборудования. Слухи о странных сигналах, исходящих из B-99, намекают на возможные следы древней технологии, но подтверждений нет.\n\nСвязи:\nС 14-A: Опорный Пункт II в 14-A обслуживает научные корабли, исследующие B-99 в 8-A, и ремонтирует повреждённое излучением оборудование "Пульсар-4".\nС 16-C: Данные о B-99 из 8-A используются в квантовых экспериментах 16-C, а "Quantum-Ark" пытается получить доступ к сигналам "Пульсар-4".\nС 13-B: Контрабандисты из 13-B интересуются слухами о технологиях в 8-A, пытаясь перехватить данные "Пульсар-4" для продажи на чёрном рынке.'
  },
  { 
    id: '17-D', 
    name: 'Сектор 17-D', 
    type: 'registered', 
    description: 'Содержит значительное количество астероидных полей. Потенциально опасен для навигации.', 
    status: 'Требует внимания',
    fullDescription: 'Сектор 17-D — хаотичный регион, заполненный обширными астероидными полями, которые делают навигацию крайне рискованной. Густые скопления каменных и металлических обломков, некоторые размером с небольшие луны, создают лабиринт, где корабли легко теряют курс или получают повреждения. Сектор содержит несколько звёзд, но планет мало, и все они — бесплодные скалы.\n\nАстероиды богаты минералами, включая железо и никель, но добыча затруднена из-за постоянных столкновений и нестабильных траекторий обломков. Небольшая ретрансляционная станция "Эхо-9" поддерживает связь, но часто выходит из строя. Пилоты избегают 17-D, а те, кто рискует, нередко сталкиваются с неопознанными сигналами, исходящими из глубин астероидных полей.\n\nСвязи:\nС 13-B: Контрабандисты из 13-B используют астероидные поля 17-D как укрытие для тайных складов и перевалочных баз, избегая патрулей.\nС 14-A: Опорный Пункт II в 14-A ремонтирует корабли, повреждённые в 17-D, и обслуживает станцию "Эхо-9", пытаясь расшифровать неопознанные сигналы.\nС 9-D: Минералы из астероидов 17-D менее ценные, чем в 9-D, но "Nova-Mine" рассматривает сектор как резервный источник, несмотря на риски.'
  },
  { 
    id: '7-B', 
    name: 'Сектор 7-B', 
    type: 'registered', 
    description: 'Сектор с низкой звездной плотностью. Используется как контрольная точка при дальних перелетах.', 
    status: 'Стандартный',
    fullDescription: 'Сектор 7-B — малозвёздный регион с низкой плотностью светил, что делает его удобной контрольной точкой для дальних гиперпространственных перелётов. Отсутствие крупных планет и астероидных полей обеспечивает чистое пространство для навигационных расчётов. Единственный заметный объект — автоматический маяк "Сигма-3", который передаёт стабильные сигналы для корректировки маршрутов.\n\nСектор безопасен, но из-за удалённости редко посещается, кроме как для калибровки. Иногда пилоты сообщают о слабых радиопомехах неизвестного происхождения, но их источник не найден.\n\nСвязи:\nС 15-B: Маяк "Сигма-3" в 7-B часто используется вместе со станцией "Орион-К" в 15-B для точной калибровки навигации на дальних маршрутах.\nС 10-C: Транзитные корабли из 10-C проходят через 7-B как контрольную точку перед выходом на основные гиперпространственные трассы.\nС 14-A: Опорный Пункт II в 14-A обслуживает редкие корабли, заходящие в 7-B, и обновляет оборудование маяка "Сигма-3".'
  },
  { 
    id: '18-A', 
    name: 'Сектор 18-A', 
    type: 'registered', 
    description: 'Зарегистрирован как стратегический сектор ввиду близости к главным транспортным путям.', 
    status: 'Стратегическое значение',
    fullDescription: 'Сектор 18-A — стратегически важный регион благодаря близости к ключевым транспортным путям, связывающим крупные галактические узлы. Сектор включает несколько звёздных систем с небольшими планетами, преимущественно газовыми или каменистыми, без особой ценности. Главный объект — военная станция "Аванпост Кси", контролируемая объединённым флотом корпораций. Она служит для мониторинга трафика, защиты торговых путей и перехвата несанкционированных судов.\n\nВысокая активность патрулей делает сектор безопасным, но строгая бюрократия и проверки раздражают пилотов. Слухи о скрытых сенсорах, отслеживающих каждый корабль, подпитывают паранойю среди контрабандистов.\n\nСвязи:\nС 10-C: Сектор 18-A контролирует транспортные потоки, идущие через 10-C, усиливая патрулирование, чтобы предотвратить нападения грабителей.\nС 13-B: "Аванпост Кси" в 18-A активно противодействует контрабандистам из 13-B, что приводит к постоянным стычкам на границах секторов.\nС 14-A: Опорный Пункт II в 14-A поставляет запчасти и топливо для патрульных кораблей 18-A, но слухи о коррупции связывают станции.'
  },
  { 
    id: '19-C', 
    name: 'Сектор 19-C', 
    type: 'explored', 
    description: 'Исследован в 2180. Обнаружены признаки древней технологической активности неизвестной цивилизации.', 
    status: 'Исследуется (повторно)',
    fullDescription: 'Сектор 19-C, исследованный в 2180 году, привлекает внимание из-за следов древней технологической активности неизвестной цивилизации. Сектор включает несколько звёздных систем с разрушенными планетами и астероидными поясами, где найдены фрагменты структур из неизвестных сплавов и неактивные энергетические узлы. Главный объект — полуразрушенная орбитальная платформа "Реликт-12", предположительно бывшая станция наблюдения.\n\nАртефакты излучают слабые сигналы, но их назначение неизвестно, а попытки активации заканчивались сбоями оборудования. Исследования осложняются нестабильными магнитными полями. Сектор находится под карантином, но привлекает искателей приключений и чёрных археологов.\n\nСвязи:\nС 13-B: Контрабандисты из 13-B тайно вывозят артефакты из 19-C на чёрный рынок, рискуя нарушить карантин.\nС 14-A: Опорный Пункт II в 14-A обслуживает исследовательские корабли, изучающие 19-C, и анализирует данные с "Реликт-12".\nС 16-C: "Quantum-Ark" из 16-C интересуется сигналами 19-C, подозревая связь с квантовыми технологиями, и пытается получить доступ к артефактам.'
  },
  { 
    id: '20-D', 
    name: 'Сектор 20-D', 
    type: 'registered', 
    description: 'Стандартный сектор с регулярным движением транспортных и исследовательских кораблей.', 
    status: 'Зарегистрирован',
    fullDescription: 'Сектор 20-D — типичный регион с умеренной звёздной плотностью, где проходит регулярное движение транспортных и исследовательских кораблей. Сектор включает несколько звёздных систем с газовыми гигантами и каменистыми планетами, не представляющими особой ценности. Основной объект — торговая станция "Нексус-5", служащая перевалочным пунктом для заправки, обмена грузами и ремонта.\n\nНавигация проста, а угрозы минимальны, что делает сектор популярным для рутинных рейсов. Однако высокая проходимость привлекает мелких мошенников, устраивающих аферы на "Нексус-5".\n\nСвязи:\nС 10-C: Сектор 20-D соединён с транзитным коридором 10-C, и многие корабли используют "Нексус-5" как промежуточную остановку.\nС 14-A: Опорный Пункт II в 14-A обслуживает исследовательские корабли, заходящие в 20-D, и поставляет запчасти для "Нексус-5".\nС 13-B: Мошенники и контрабандисты из 13-B проникают на "Нексус-5" в 20-D, используя станцию для нелегальных сделок.'
  },
  { 
    id: '21-A', 
    name: 'Сектор 21-A', 
    type: 'restricted', 
    description: 'Закрыт для посещения. Сильные гравитационные аномалии. Высокий риск структурного повреждения кораблей.', 
    status: 'Опасная зона',
    fullDescription: 'Сектор 21-A — запрещённая зона, полностью закрытая для посещения из-за мощных гравитационных аномалий, вызывающих непредсказуемые искажения пространства. Сектор включает одну звёздную систему с чёрной дырой в центре, окружённой обломками планет и астероидов. Аномалии создают зоны повышенного риска, где корабли могут быть раздавлены или потерять управление.\n\nНикаких станций или постоянных объектов нет, а редкие зонды, отправленные для исследований, либо уничтожаются, либо возвращают искажённые данные. Слухи говорят о возможной связи аномалий с экспериментами древних цивилизаций, но доказательств нет.\n\nСвязи:\nС 16-C: "Quantum-Ark" из 16-C тайно изучает аномалии 21-A, подозревая их связь с квантовыми структурами, несмотря на запрет.\nС 14-A: Опорный Пункт II в 14-A ремонтирует редкие корабли, пострадавшие при попытке приблизиться к 21-A, и анализирует обломки зондов.\nС 19-C: Сигналы из 19-C, связанные с древними технологиями, имеют схожие характеристики с данными зондов из 21-A, что вызывает интерес учёных.'
  },
  { 
    id: '22-B', 
    name: 'Сектор 22-B', 
    type: 'explored', 
    description: 'Полностью исследован. Содержит 7 звездных систем. Нет обитаемых планет.', 
    status: 'Изучен',
    fullDescription: 'Сектор 22-B — полностью исследованный регион, включающий семь звёздных систем без обитаемых планет. В основном это газовые гиганты, каменистые тела и астероидные пояса с низкоценными ресурсами. Сектор не представляет интереса для колонизации или добычи, но его стабильные условия делают его удобным для научных наблюдений. Главный объект — обсерватория "Стеллар-7", изучающая звёздные циклы и космическое излучение.\n\nСектор безопасен, но из-за отсутствия экономической ценности редко посещается, кроме учёных и транзитных рейсов. Некоторые данные "Стеллар-7" засекречены, что порождает слухи о скрытых открытиях.\n\nСвязи:\nС 14-A: Опорный Пункт II в 14-A обслуживает корабли, направляющиеся к обсерватории "Стеллар-7" в 22-B, и поставляет оборудование для исследований.\nС 16-C: "Quantum-Ark" из 16-C запрашивает данные "Стеллар-7" из 22-B, подозревая связь звёздных циклов с квантовыми аномалиями.\nС 10-C: Транзитные корабли из 10-C иногда проходят через 22-B, используя его как безопасный промежуточный пункт.'
  },
];

// Добавляем компонент для портала выпадающего списка
const PseudoStarDropdown = ({ isOpen, onSelect, items, position }) => {
  if (!isOpen || !position) return null;

  // Создаем портал, который будет жить вне DOM-дерева основного компонента
  return createPortal(
    <div 
      className={styles.dropdown} 
      style={{
        position: 'fixed',
        top: `${position.top}px`,
        left: `${position.left}px`,
        width: `${position.width}px`
      }}
    >
      {items.map((star, index) => (
        <div 
          key={index} 
          className={styles.dropdownItem}
          onClick={() => onSelect(star)}
        >
          {star}
        </div>
      ))}
    </div>,
    document.body // Монтируем непосредственно в body
  );
};

const ShipInfoModal = ({ onClose, shipData }) => {
  const modalRef = useRef(null);
  const [activeTab, setActiveTab] = useState('vessel'); // vessel, adnexux, sector, sectors-map, sectors-info, companies, reports, terminal
  const [selectedSector, setSelectedSector] = useState(null); // Для выбора сектора в разделе SECTORS INFO
  const [activeCompany, setActiveCompany] = useState('helios-tech'); // Для подвкладок раздела COMPANIES
  
  // Отслеживание посещенных вкладок
  const [visitedTabs, setVisitedTabs] = useState({
    vessel: false,
    adnexux: false,
    sector: false,
    'sectors-map': false,
    'sectors-info': false,
    companies: false,
    reports: false
  });
  
  // Удалены неиспользуемые переменные terminalActive и setTerminalActive
  const [terminalInput, setTerminalInput] = useState('');
  const [terminalHistory, setTerminalHistory] = useState([
    { type: 'system', content: '====== ADNOS TERMINAL v3.7.2 ======' },
    { type: 'system', content: 'Подключение к центральной системе... Выполнено' },
    { type: 'system', content: 'Доступ разрешен. Добро пожаловать, пользователь.' },
    { type: 'system', content: 'Введите команду или \'help\' для списка команд' },
  ]);
  const [showPseudoStarDropdown, setShowPseudoStarDropdown] = useState(false);
  const [pseudoStarDropdownPosition, setPseudoStarDropdownPosition] = useState({ top: 0, left: 0 });
  // Удалены неиспользуемые переменные reportForm и setReportForm
  const [reportStatus, setReportStatus] = useState('idle'); // idle, submitting, success, error
  
  // Добавляем состояние для отслеживания раскрытия секретной информации
  const [secretInfoRevealed, setSecretInfoRevealed] = useState(false);
  
  // Удалены неиспользуемые переменные terminalRef и pseudoStarRef
  const terminalOutputRef = useRef(null);
  const terminalInputRef = useRef(null);
  const [processingCommand, setProcessingCommand] = useState(false);
  const [suggestionVisible, setSuggestionVisible] = useState(false);
  
  // Загрузка состояния секретной информации из localStorage только при старте приложения
  // Удаляем этот useEffect, чтобы информация не загружалась автоматически из localStorage
  // useEffect(() => {
  //   const wasSecretRevealed = localStorage.getItem('secretInfoRevealed') === 'true';
  //   if (wasSecretRevealed) {
  //     setSecretInfoRevealed(true);
  //   }
  // }, []);
  
  // Проверка, все ли вкладки были посещены
  const allTabsVisited = Object.values(visitedTabs).every(visited => visited);
  
  // Проверка, была ли вкладка разблокирована ранее для текущего сеанса
  const [terminalUnlocked, setTerminalUnlocked] = useState(false);
  
  // Отслеживаем посещение всех вкладок
  useEffect(() => {
    if (allTabsVisited) {
      // Разблокируем вкладку Terminal только когда посетили все другие вкладки
      setTerminalUnlocked(true);
      localStorage.setItem('terminalUnlocked', 'true');
    }
  }, [allTabsVisited]);
  
  // При инициализации проверяем, была ли разблокирована вкладка ранее
  useEffect(() => {
    const wasUnlocked = localStorage.getItem('terminalUnlocked') === 'true';
    if (wasUnlocked) {
      setTerminalUnlocked(true);
    }
  }, []);
  
  // Референс для звука клика
  const cliSoundRef = useRef(null);
  const termSoundRef = useRef(null);
  
  // Референсы для музыки
  const normalMusicRef = useRef(null);
  const specialMusicRef = useRef(null);
  
  // Состояние для формы отчетов
  const [starId, setStarId] = useState('');
  const [pseudoStar, setPseudoStar] = useState(''); // Поле для псевдо-звезд
  const [anomalyId, setAnomalyId] = useState(''); // Новое поле для аномалий
  const [reportField2, setReportField2] = useState('');
  const [coordinates, setCoordinates] = useState(''); // Координаты XYZ
  const [validationError, setValidationError] = useState('');
  const [pseudoStarSuccess, setPseudoStarSuccess] = useState(false); // Флаг успешного ввода псевдо-звезды
  const [anomalySuccess, setAnomalySuccess] = useState(false); // Флаг успешного отчета об аномалии
  const pseudoStarInputRef = useRef(null);
  
  // Regex для валидации
  const starIdPattern = /^#[\d-]{3,4}_[\d-]{1,2}$/;
  const coordinatesPattern = /^X - \d+\.\d{2}\s+Y - \d+\.\d{2}\s+Z - \d+\.\d{2}$/;
  const anomalyPattern = /^\[АНОМАЛИЯ\]$/; // Паттерн для аномалии
  
  // Доступные команды терминала
  const terminalCommands = [
    { command: 'ADNOS SIGNAL', description: 'Поиск сигнала ADNOS...' }
  ];
  
  // Инициализация звуковых эффектов и музыки
  useEffect(() => {
    if (typeof window !== 'undefined') {
      // Инициализация звуков интерфейса
      cliSoundRef.current = new Audio('/assets/sounds/Cli.mp3');
      cliSoundRef.current.volume = 0.15;
      
      // Звук для терминала (используем C.mp3)
      termSoundRef.current = new Audio('/assets/sounds/C.mp3');
      termSoundRef.current.volume = 0.15;
      
      // Инициализация музыки без автоматического воспроизведения
      normalMusicRef.current = new Audio('/assets/sounds/Mus.mp3');
      normalMusicRef.current.volume = 0.2;
      normalMusicRef.current.loop = true;
      
      // Инициализация специальной музыки для ADNOS SIGNAL
      specialMusicRef.current = new Audio('/assets/sounds/Mus2.mp3');
      specialMusicRef.current.volume = 0.3;
      specialMusicRef.current.loop = true;
      
      // НЕ запускаем фоновую музыку автоматически, чтобы избежать дублирования
      // Теперь музыка будет воспроизводиться только при команде ADNOS SIGNAL
    }
    
    return () => {
      // Очистка всех аудио ресурсов при размонтировании
      if (cliSoundRef.current) {
        cliSoundRef.current.pause();
        cliSoundRef.current = null;
      }
      if (termSoundRef.current) {
        termSoundRef.current.pause();
        termSoundRef.current = null;
      }
      if (normalMusicRef.current) {
        normalMusicRef.current.pause();
        normalMusicRef.current = null;
      }
      if (specialMusicRef.current) {
        specialMusicRef.current.pause();
        specialMusicRef.current = null;
      }
    };
  }, []);
  
  // Функции для управления музыкой
  const switchToSpecialMusic = () => {
    if (normalMusicRef.current && specialMusicRef.current) {
      // Запускаем специальную музыку с плавным нарастанием (fade in)
      specialMusicRef.current.volume = 0; // Начинаем с нулевой громкости
      specialMusicRef.current.play().catch(e => console.log('Audio play error:', e));
      
      // Плавно увеличиваем громкость
      let volume = 0;
      const fadeIn = setInterval(() => {
        volume += 0.01;
        if (volume >= 0.3) {
          volume = 0.3;
          clearInterval(fadeIn);
        }
        specialMusicRef.current.volume = volume;
      }, 50); // Шаг каждые 50 мс, полное нарастание примерно за 1.5 секунды
    }
  };
  
  const switchToNormalMusic = () => {
    if (specialMusicRef.current) {
      // Плавно уменьшаем громкость (fade out)
      let volume = specialMusicRef.current.volume;
      const fadeOut = setInterval(() => {
        volume -= 0.01;
        if (volume <= 0) {
          volume = 0;
          clearInterval(fadeOut);
          // Останавливаем специальную музыку только после полного затухания
          specialMusicRef.current.pause();
          specialMusicRef.current.currentTime = 0;
        }
        specialMusicRef.current.volume = volume;
      }, 50); // Шаг каждые 50 мс, полное затухание примерно за 1.5 секунды
    }
  };
  
  // Функция для анимированного вывода текста с поддержкой пауз
  const typeText = (text, type, delay = 35, callback = null) => {
    let index = 0;
    
    setProcessingCommand(true);
    
    // Создаем новую запись в истории для этого сообщения
    setTerminalHistory(prev => [...prev, { type, content: '' }]);
    
    // Заменяем маркеры пауз на специальный символ
    const processedText = text.replace(/\[pause\]/g, '␣');
    
    const timer = setInterval(() => {
      if (index < processedText.length) {
        // Если текущий символ - маркер паузы, делаем задержку
        if (processedText[index] === '␣') {
          clearInterval(timer);
          setTimeout(() => {
            // Продолжаем без добавления символа паузы в вывод
            index++;
            setTerminalHistory(prev => {
              const updatedHistory = [...prev];
              const lastEntry = updatedHistory[updatedHistory.length - 1];
              lastEntry.content = processedText.substring(0, index).replace(/␣/g, '');
              return updatedHistory;
            });
            
            // Возобновляем обычную печать
            const newTimer = setInterval(() => {
              if (index < processedText.length) {
                // Снова проверяем, не пауза ли это
                if (processedText[index] === '␣') {
                  clearInterval(newTimer);
                  // Рекурсивно вызываем ту же функцию с обновленным индексом
                  setTimeout(() => {
                    typeText(processedText.substring(index), type, delay, callback);
                  }, 800); // Длительность паузы
                  return;
                }
                
                // Воспроизводим звук печати для каждого символа
                if (termSoundRef.current) {
                  const soundClone = termSoundRef.current.cloneNode();
                  soundClone.volume = 0.15;
                  soundClone.play().catch(e => console.log('Audio play error:', e));
                }
                
                setTerminalHistory(prev => {
                  const updatedHistory = [...prev];
                  const lastEntry = updatedHistory[updatedHistory.length - 1];
                  lastEntry.content = processedText.substring(0, index + 1).replace(/␣/g, '');
                  return updatedHistory;
                });
                
                index++;
              } else {
                clearInterval(newTimer);
                if (callback) setTimeout(callback, 1000);
                if (index >= processedText.length) setProcessingCommand(false);
              }
            }, delay);
          }, 800); // Длительность паузы
          return;
        }
        
        // Воспроизводим звук печати для каждого символа
        if (termSoundRef.current) {
          const soundClone = termSoundRef.current.cloneNode();
          soundClone.volume = 0.15;
          soundClone.play().catch(e => console.log('Audio play error:', e));
        }
        
        setTerminalHistory(prev => {
          const updatedHistory = [...prev];
          // Обновляем последнюю запись, добавляя следующую часть текста
          const lastEntry = updatedHistory[updatedHistory.length - 1];
          lastEntry.content = processedText.substring(0, index + 1).replace(/␣/g, '');
          return updatedHistory;
        });
        
        index++;
      } else {
        clearInterval(timer);
        if (callback) setTimeout(callback, 1000);
        if (index >= processedText.length) setProcessingCommand(false);
      }
    }, delay);
    
    return timer;
  };
  
  // Функция для выполнения команды ADNOS SIGNAL
  const executeAdnasSignal = () => {
    // Начинаем последовательность анимации с более интерактивным и плавным отображением
    setTerminalHistory(prev => [...prev, { type: 'system', content: 'Инициализация поиска сигнала ADNOS...' }]);
    
    // Добавляем класс свечения к терминалу
    if (terminalOutputRef.current) {
      terminalOutputRef.current.classList.add(styles.terminalGlowing);
    }
    
    setTimeout(() => {
      typeText("Сканирование частотного диапазона... [█████░░░░░] 50%", 'progress', 50, () => {
        setTimeout(() => {
          typeText("Сканирование частотного диапазона... [██████████] 100%", 'progress', 50, () => {
            setTimeout(() => {
              typeText("Анализ квантовых следов...", 'system', 60, () => {
                setTimeout(() => {
                  typeText("Обнаружены фрагменты сигнатуры ADNOS!", 'system', 40, () => {
                    setTimeout(() => {
                      setTerminalHistory(prev => [...prev, { 
                        type: 'warning', 
                        content: '>> ВНИМАНИЕ: Обнаружен ADNOS протокол. Устанавливаю защищенное соединение... <<' 
                      }]);
                      
                      // Усиливаем эффект свечения и меняем музыку
                      if (terminalOutputRef.current) {
                        terminalOutputRef.current.classList.add(styles.terminalIntenseGlowing);
                      }
                      
                      // Переключаемся на специальную музыку
                      switchToSpecialMusic();
                      
                      // Устанавливаем флаг раскрытия секретной информации
                      setSecretInfoRevealed(true);
                      localStorage.setItem('secretInfoRevealed', 'true');
                      
                      setTimeout(() => {
                        // Диалог N28 с паузами - добавляем паузу после "Adnos?"
                        typeText("N28: Adnos?[pause] Быть не может, так это правда?[pause] Сектор 12-A..[pause] Погоди...[pause] координаты...[pause] не могу получить к ним доступ..", 'n28', 100, () => {
                          // Вызываем новую функцию с улучшенной анимацией
                          simulateCoordinatesInterception();
                        });
                      }, 2000);
                    }, 800);
                  });
                }, 1000);
              });
            }, 800);
          });
        }, 800);
      });
    }, 1000);
  };
  
  // Функция имитации вывода координат с последующим перехватом
  const simulateCoordinatesInterception = () => {
    // Анимация получения координат
    setTerminalHistory(prev => [...prev, { type: 'system', content: 'Запрос координат...' }]);
    
    // Добавляем анимацию поиска
    setTimeout(() => {
      setTerminalHistory(prev => [
        ...prev, 
        { type: 'system', content: 'Инициализация поиска квантовых следов...' }
      ]);
      
      // Имитация вычисления с прогресс-баром
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += 10;
        if (progress <= 100) {
          setTerminalHistory(prev => {
            const updatedHistory = [...prev];
            const lastIndex = updatedHistory.length - 1;
            // Обновляем последнее сообщение, добавляя прогресс-бар с более интересной фразой
            updatedHistory[lastIndex] = {
              type: 'progress',
              content: `Квантовая калибровка маяков: [${Array(progress/10).fill('■').join('')}${Array(10-progress/10).fill('□').join('')}] ${progress}%`
            };
            return updatedHistory;
          });
        } else {
          clearInterval(progressInterval);
          
          // Начинаем показ найденных координат
          setTerminalHistory(prev => [
            ...prev, 
            { type: 'system', content: 'Координаты обнаружены:' }
          ]);
          
          // Имитация начала вывода координат с использованием "?" вместо конкретных значений
          setTimeout(() => {
            setTerminalHistory(prev => [
              ...prev, 
              { type: 'coordinates', content: 'X: ?.????' }
            ]);
            
            setTimeout(() => {
              setTerminalHistory(prev => [
                ...prev, 
                { type: 'coordinates', content: 'Y: ?.????' }
              ]);
              
              setTimeout(() => {
                setTerminalHistory(prev => [
                  ...prev, 
                  { type: 'coordinates', content: 'Z: ?.????' }
                ]);
                
                // Начало вычисления временного сдвига
                setTimeout(() => {
                  setTerminalHistory(prev => [
                    ...prev, 
                    { type: 'system', content: 'Расчет темпорального вектора...' }
                  ]);
                  
                  // Здесь происходит перехват Isiris
                  setTimeout(() => {
                    // Визуальный эффект перехвата - мерцание терминала
                    if (terminalOutputRef.current) {
                      terminalOutputRef.current.classList.add(styles.terminalFlicker);
                      setTimeout(() => {
                        terminalOutputRef.current.classList.remove(styles.terminalFlicker);
                      }, 800);
                    }
                    
                    // Добавляем сообщение о перехвате
                    setTerminalHistory(prev => [
                      ...prev, 
                      { type: 'warning', content: 'ВНИМАНИЕ: Обнаружено внешнее вмешательство в канал связи' }
                    ]);
                    
                    // Сообщение Isiris о блокировке
                    setTimeout(() => {
                      typeText("ISIRIS: Попытка получения координат перехвачена, запущен процесс разрыва связи", 'isiris', 120, () => {
                        // Анимация процесса разрыва
                        setTerminalHistory(prev => [
                          ...prev, 
                          { type: 'warning', content: 'ВНИМАНИЕ: Обнаружено внешнее вмешательство в систему' }
                        ]);
                        
                        // Добавляем эффект опасности
                        if (terminalOutputRef.current) {
                          terminalOutputRef.current.classList.remove(styles.terminalGlowing);
                          terminalOutputRef.current.classList.remove(styles.terminalIntenseGlowing);
                          terminalOutputRef.current.classList.add(styles.terminalDanger);
                        }
                        
                        // Улучшенная анимация разрыва связи с визуальными эффектами
                        setTimeout(() => {
                          setTerminalHistory(prev => [
                            ...prev, 
                            { type: 'warning', content: '>> Блокировка каналов связи инициирована <<' }
                          ]);
                          
                          // Добавляем эффект мерцания для создания напряжения
                          if (terminalOutputRef.current) {
                            terminalOutputRef.current.classList.add(styles.terminalFlicker);
                            setTimeout(() => {
                              terminalOutputRef.current.classList.remove(styles.terminalFlicker);
                            }, 1000);
                          }
                          
                          setTimeout(() => {
                            // Имитация процесса закрытия каналов с прогресс-индикацией
                            setTerminalHistory(prev => [
                              ...prev, 
                              { type: 'progress', content: 'Отключение квантовых каналов: [▓▓▓▓▓▓░░░░] 60%' }
                            ]);
                            
                            setTimeout(() => {
                              setTerminalHistory(prev => [
                                ...prev, 
                                { type: 'progress', content: 'Отключение квантовых каналов: [▓▓▓▓▓▓▓▓░░] 80%' }
                              ]);
                              
                              setTimeout(() => {
                                setTerminalHistory(prev => [
                                  ...prev, 
                                  { type: 'progress', content: 'Отключение квантовых каналов: [▓▓▓▓▓▓▓▓▓▓] 100%' }
                                ]);
                              
                                setTimeout(() => {
                                  setTerminalHistory(prev => [
                                    ...prev, 
                                    { type: 'system', content: 'Протокол безопасности S-7 активирован' }
                                  ]);
                                  
                                  setTimeout(() => {
                                    // Отчаянное сообщение N28
                                    typeText("N28: Нет нет нет! Isiris прекрати выполнение, немедленно!", 'n28-urgent', 90, () => {
                                      setTimeout(() => {
                                        // Финальное сообщение о разрыве связи с более драматичным эффектом
                                        setTerminalHistory(prev => [
                                          ...prev, 
                                          { type: 'system-error', content: 'КРИТИЧЕСКАЯ ОШИБКА' }
                                        ]);
                                        
                                        // Сильное мерцание перед финальным разрывом
                                        if (terminalOutputRef.current) {
                                          terminalOutputRef.current.classList.add(styles.terminalFlicker);
                                          terminalOutputRef.current.classList.add(styles.terminalCritical);
                                          setTimeout(() => {
                                            terminalOutputRef.current.classList.remove(styles.terminalFlicker);
                                          }, 1200);
                                        }
                                        
                                        setTimeout(() => {
                                          typeText("СВЯЗЬ РАЗОРВАНА", 'connection-lost', 200, () => {
                                            // Возвращаем нормальную музыку после завершения диалога
                                            setTimeout(() => {
                                              switchToNormalMusic();
                                              
                                              // Сохраняем состояние что терминал был использован
                                              localStorage.setItem('terminalUsed', 'true');
                                            }, 2000);
                                          });
                                        }, 1000);
                                      }, 1500);
                                    });
                                  }, 2000);
                                }, 800);
                              }, 800);
                            }, 800);
                          }, 1500);
                        }, 1500);
                      });
                    }, 1000);
                  }, 2000);
                }, 1500);
              }, 800);
            }, 800);
          }, 1200);
        }
      }, 200);
    }, 1000);
  };
  
  // Обработка закрытия по нажатию Escape
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'Escape') {
        onClose();
      }
    };
    
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [onClose]);

  // Закрытие при клике вне модального окна
  const handleOutsideClick = (e) => {
    if (modalRef.current && !modalRef.current.contains(e.target)) {
      onClose();
    }
  };
  
  // Воспроизведение звука клика
  const playCliSound = () => {
    if (cliSoundRef.current) {
      cliSoundRef.current.currentTime = 0;
      cliSoundRef.current.play().catch(e => console.log('Audio play error:', e));
    }
  };
  
  // Функция для переключения вкладки с воспроизведением звука
  const handleTabChange = (tab) => {
    if (cliSoundRef.current) {
      cliSoundRef.current.currentTime = 0;
      cliSoundRef.current.play().catch(e => console.log('Audio play error:', e));
    }
    
    // Отмечаем вкладку как посещенную
    setVisitedTabs(prev => ({
      ...prev,
      [tab]: true
    }));
    
    setActiveTab(tab);
  };
  
  // Обработка фокуса на терминале
  useEffect(() => {
    if (activeTab === 'terminal' && terminalInputRef.current) {
      terminalInputRef.current.focus();
    }
  }, [activeTab]);
  
  // Автопрокрутка терминала
  useEffect(() => {
    if (terminalOutputRef.current) {
      terminalOutputRef.current.scrollTop = terminalOutputRef.current.scrollHeight;
    }
  }, [terminalHistory]);
  
  // Обработка ввода в терминале
  const handleTerminalInputChange = (e) => {
    const value = e.target.value;
    
    // Добавляем небольшую задержку для более реалистичного эффекта печати
    setTimeout(() => {
      setTerminalInput(value);
    }, 10);
    
    // Проверяем, соответствует ли ввод какой-либо команде для подсказки
    const upperInput = value.toUpperCase();
    const matchingCommand = terminalCommands.find(cmd => 
      cmd.command.startsWith(upperInput) && upperInput.length > 0 && upperInput !== cmd.command
    );
    
    // Если есть совпадение, показываем подсказку
    setSuggestionVisible(!!matchingCommand);
    
    // Воспроизводим звук C.mp3 при каждом вводе символа
    if (value.length > terminalInput.length && termSoundRef.current) {
      const soundClone = termSoundRef.current.cloneNode();
      soundClone.volume = 0.15;
      soundClone.play().catch(e => console.log('Audio play error:', e));
    }
  };
  
  // Обработка клавиши Tab для автодополнения
  const handleTerminalKeyDown = (e) => {
    if (e.key === 'Tab' && suggestionVisible) {
      e.preventDefault();
      const upperInput = terminalInput.toUpperCase();
      const matchingCommand = terminalCommands.find(cmd => 
        cmd.command.startsWith(upperInput)
      );
      
      if (matchingCommand) {
        setTerminalInput(matchingCommand.command);
        setSuggestionVisible(false);
      }
    }
  };
  
  // Обработка отправки команды терминала
  const handleTerminalSubmit = (e) => {
    e.preventDefault();
    
    if (!terminalInput.trim() || processingCommand) return;
    
    // Добавляем введенную команду в историю
    setTerminalHistory(prev => [
      ...prev,
      { type: 'input', content: `> ${terminalInput}` }
    ]);
    
    const command = terminalInput.trim().toUpperCase();
    
    // Обработка команд
    if (command === 'ADNOS SIGNAL') {
      executeAdnasSignal();
    } else if (command === 'HELP') {
      setTerminalHistory(prev => [
        ...prev,
        { type: 'system', content: 'Доступные команды:' },
        { type: 'system', content: '  ADNOS SIGNAL - Поиск сигнала ADNOS...' },
        { type: 'system', content: '  HELP - Показать список команд' },
        { type: 'system', content: '  CLEAR - Очистить терминал' }
      ]);
    } else if (command === 'CLEAR') {
      setTerminalHistory([
        { type: 'system', content: '====== ADNOS TERMINAL v3.7.2 ======' },
        { type: 'system', content: 'Терминал очищен.' }
      ]);
    } else {
      // Неизвестная команда
      setTerminalHistory(prev => [
        ...prev,
        { type: 'system', content: `Команда "${terminalInput}" не распознана. Введите "help" для списка команд.` }
      ]);
    }
    
    // Очищаем поле ввода
    setTerminalInput('');
    setSuggestionVisible(false);
  };
  
  // Функция для отправки отчета с добавлением звука
  const handleSubmitReport = (e) => {
    e.preventDefault();
    
    // Воспроизводим звук клика
    playCliSound();
    
    // Сбрасываем ошибки
    setValidationError('');
    
    // Проверяем, есть ли данные о псевдо-звезде и допустимо ли имя
    const hasPseudoStarData = pseudoStar && ALLOWED_PSEUDO_STARS.includes(pseudoStar);
    
    // Проверяем формат аномалии, если поле заполнено
    const hasAnomalyData = anomalyId && anomalyPattern.test(anomalyId);
    
    // Валидация ID звезды - обязательно только если не выбрана псевдо-звезда
    if (!hasPseudoStarData && !starIdPattern.test(starId)) {
      setValidationError('Неверный формат ID звезды. Проверьте формат и попробуйте снова.');
      return;
    }
    
    // Проверка координат (обязательны для любого рапорта)
    if (!coordinates.trim() || !coordinatesPattern.test(coordinates)) {
      setValidationError('Необходимо указать корректные координаты в формате: X - xxx.xx Y - xxx.xx Z - xxx.xx');
      return;
    }
    
    if (pseudoStar && !hasPseudoStarData) {
      setValidationError('Выберите допустимое название псевдо-звезды из списка.');
      return;
    }
    
    if (anomalyId && !hasAnomalyData) {
      setValidationError('Неверный формат аномалии. Используйте шаблон [АНОМАЛИЯ]');
      return;
    }
    
    // Имитация отправки
    setReportStatus('sending');
    
    // Имитация задержки ответа сервера
    setTimeout(() => {
      setReportStatus('success');
      setPseudoStarSuccess(hasPseudoStarData); // Устанавливаем флаг успешной псевдо-звезды
      setAnomalySuccess(hasAnomalyData); // Устанавливаем флаг успешного отчета об аномалии
    }, 1500);
  };
  
  // Функция для сброса формы отчета
  const resetReportForm = () => {
    setReportStatus('idle');
    setStarId('');
    setPseudoStar('');
    setAnomalyId('');
    setReportField2('');
    setCoordinates('');
    setPseudoStarSuccess(false);
    setAnomalySuccess(false);
  };

  // Обработчик для выбора звезды из выпадающего списка
  const handlePseudoStarSelect = (star) => {
    setPseudoStar(star);
    setShowPseudoStarDropdown(false);
    playCliSound(); // Добавляем звуковой эффект выбора
  };

  // Функция для заполнения поля координат с добавлением звука
  const fillCurrentCoordinates = () => {
    // Воспроизводим звук клика
    playCliSound();
    
    // Проверяем, есть ли в shipData реальные координаты навигационной панели
    if (shipData && shipData.coordinates) {
      const x = parseFloat(shipData.coordinates.x).toFixed(2);
      const y = parseFloat(shipData.coordinates.y).toFixed(2);
      const z = parseFloat(shipData.coordinates.z || 0).toFixed(2);
      
      setCoordinates(`X - ${x}  Y - ${y}  Z - ${z}`);
    } else {
      // Используем фиксированные координаты из навигационных данных SpaceHUD
      // Примечание: Эти значения должны совпадать с актуальными значениями в SpaceHUD
      // В идеале эти координаты должны передаваться через shipData
      const xCoord = 245.00;
      const yCoord = 873.00;
      // Получаем примерное значение Z из текущего времени для имитации реальных показаний
      const now = new Date();
      const zCoord = parseFloat(15042.00 + (now.getSeconds() / 60 * 100)).toFixed(2);
      
      setCoordinates(`X - ${xCoord}  Y - ${yCoord}  Z - ${zCoord}`);
    }
  };

  // Функция для переключения компании в разделе COMPANIES
  const handleCompanyChange = (company) => {
    if (cliSoundRef.current) {
      cliSoundRef.current.currentTime = 0;
      cliSoundRef.current.play().catch(e => console.log('Audio play error:', e));
    }
    setActiveCompany(company);
  };

  // Добавляем функцию для расчета позиции выпадающего списка
  const updateDropdownPosition = () => {
    if (pseudoStarInputRef.current) {
      const rect = pseudoStarInputRef.current.getBoundingClientRect();
      setPseudoStarDropdownPosition({
        top: rect.bottom + 5,
        left: rect.left,
        width: rect.width
      });
    }
  };

  // Обновляем позицию при открытии
  const togglePseudoStarDropdown = () => {
    if (!showPseudoStarDropdown) {
      updateDropdownPosition();
    }
    setShowPseudoStarDropdown(!showPseudoStarDropdown);
  };

  // Обработчик событий при изменении размера окна
  useEffect(() => {
    const handleResize = () => {
      if (showPseudoStarDropdown) {
        updateDropdownPosition();
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [showPseudoStarDropdown]);

  // После инициализации, загрузим историю терминала из localStorage если она там есть
  useEffect(() => {
    const wasTerminalUsed = localStorage.getItem('terminalUsed') === 'true';
    const savedHistory = localStorage.getItem('terminalHistory');
    
    if (wasTerminalUsed && savedHistory) {
      try {
        const parsedHistory = JSON.parse(savedHistory);
        setTerminalHistory(parsedHistory);
      } catch (e) {
        console.error('Error parsing terminal history:', e);
      }
      
      // Сохраняем состояние что терминал был использован
      if (wasTerminalUsed) {
        if (terminalOutputRef.current) {
          terminalOutputRef.current.classList.add(styles.terminalCritical);
        }
      }
    }
  }, []);

  // Сохраняем историю терминала в localStorage при изменении
  useEffect(() => {
    // Сохраняем историю, только если терминал был использован
    if (localStorage.getItem('terminalUsed') === 'true') {
      localStorage.setItem('terminalHistory', JSON.stringify(terminalHistory));
    }
  }, [terminalHistory]);

  // Включаем отслеживание состояния терминала при первой загрузке
  useEffect(() => {
    const wasTerminalUsed = localStorage.getItem('terminalUsed') === 'true';
    
    if (wasTerminalUsed) {
      // Если терминал был использован ранее, восстанавливаем его состояние
      if (terminalOutputRef.current) {
        terminalOutputRef.current.classList.add(styles.terminalCritical);
      }
    }
  }, []);

  return (
    <div className={styles.modalOverlay} onClick={handleOutsideClick}>
      <div className={styles.modal} ref={modalRef}>
        <div className={styles.modalHeader}>
          <h2 className={styles.modalTitle}>ADNOS VESSEL DATA</h2>
        </div>
        
        {/* Вкладки для переключения */}
        <div className={styles.tabsContainer}>
          <button 
            className={`${styles.tabButton} ${activeTab === 'vessel' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('vessel')}
          >
            VESSEL INFO
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'adnexux' ? styles.activeTab : ''} ${secretInfoRevealed ? styles.adnexuxTab : ''}`} 
            onClick={() => handleTabChange('adnexux')}
          >
            ADNEXUX INDUSTRIES
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'sector' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('sector')}
          >
            SECTOR 12-A
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'sectors-map' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('sectors-map')}
          >
            SECTORS MAP
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'sectors-info' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('sectors-info')}
          >
            SECTORS INFO
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'companies' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('companies')}
          >
            COMPANIES
          </button>
          <button 
            className={`${styles.tabButton} ${activeTab === 'reports' ? styles.activeTab : ''}`} 
            onClick={() => handleTabChange('reports')}
          >
            REPORTS
          </button>
          {terminalUnlocked && allTabsVisited && (
            <button 
              className={`${styles.tabButton} ${styles.terminalTab} ${activeTab === 'terminal' ? styles.activeTab : ''}`} 
              onClick={() => handleTabChange('terminal')}
            >
              TERMINAL
            </button>
          )}
        </div>
        
        <div className={styles.modalContent}>
          {activeTab === 'vessel' ? (
            <>
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>VESSEL SPECIFICATIONS</h3>
                <div className={styles.infoGrid}>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>VESSEL ID</div>
                    <div className={styles.infoValue}>{shipData.id}</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>CLASS</div>
                    <div className={styles.infoValue}>{shipData.class}</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>MASS</div>
                    <div className={styles.infoValue}>{shipData.mass}</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>ENGINE</div>
                    <div className={styles.infoValue}>QUANTUM DRIVE MK-2</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>SHIELD CAPACITY</div>
                    <div className={styles.infoValue}>180 MW</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>MAX VELOCITY</div>
                    <div className={styles.infoValue}>0.8c</div>
                  </div>
                </div>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>MISSION PARAMETERS</h3>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>MISSION NAME: </span>&quot;Cold Vector&quot;
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>OBJECTIVE: </span>Собрать как можно больше информации о дальнем космосе, с особым вниманием к аномальному Сектору 12-A.
                </p>
                <p className={styles.missionText}>
                  ADNOS-X72 является исследовательским кораблем класса &quot;EXPLORER&quot;, предназначенным для глубокого изучения неизвестных областей космоса и каталогизации звездных объектов.
                </p>
                <p className={styles.missionText}>
                  Основная миссия: сбор и анализ данных о космических объектах, картографирование малоизученных секторов и регистрация аномалий пространства-времени.
                </p>
                <p className={styles.missionText}>
                  Корабль оснащен передовой системой сканирования ADNOS, способной обнаруживать и классифицировать звезды на значительных расстояниях с высокой точностью.
                </p>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>SYSTEM METRICS</h3>
                <div className={styles.metricsGrid}>
                  <div className={styles.metricItem}>
                    <div className={styles.metricLabel}>MEMORY USAGE</div>
                    <div className={styles.metricBar}>
                      <div 
                        className={styles.metricFill} 
                        style={{ width: `${shipData.systemMetrics.memory}%` }}
                      ></div>
                    </div>
                    <div className={styles.metricValue}>{shipData.systemMetrics.memory}%</div>
                  </div>
                  <div className={styles.metricItem}>
                    <div className={styles.metricLabel}>CPU USAGE</div>
                    <div className={styles.metricBar}>
                      <div 
                        className={styles.metricFill} 
                        style={{ width: `${shipData.systemMetrics.cpu}%` }}
                      ></div>
                    </div>
                    <div className={styles.metricValue}>{shipData.systemMetrics.cpu}%</div>
                  </div>
                  <div className={styles.metricItem}>
                    <div className={styles.metricLabel}>TEMPERATURE</div>
                    <div className={styles.metricBar}>
                      <div 
                        className={styles.metricFill} 
                        style={{ 
                          width: `${shipData.systemMetrics.temp}%`,
                          backgroundColor: shipData.systemMetrics.temp > 80 ? 'var(--hud-danger)' : undefined
                        }}
                      ></div>
                    </div>
                    <div className={styles.metricValue}>{shipData.systemMetrics.temp}%</div>
                  </div>
                </div>
              </div>
            </>
          ) : activeTab === 'adnexux' ? (
            <>
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>ADNEXUX INDUSTRIES: OVERVIEW</h3>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>TYPE: </span>Мегакорпорация / Частный научно-технологический синдикат
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>FOUNDED: </span>2278 г., Сектор Иридий-4
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>HEADQUARTERS: </span>Орбитальная станция Nodelis Prime
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>MISSION: </span>«Connecting what was never meant to meet.»
                </p>
                <p className={styles.missionText}>
                  Adnexus Industrie — частная межзвёздная корпорация, специализирующаяся на разработке технологий дальнего прыжка, искусственного интеллекта и автономных исследовательских судов. Известна тем, что создала Adnos — экспериментальный корабль нового класса, способный к глубокой космической разведке без поддержки флота.
                </p>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>FEATURES & REPUTATION</h3>
                <div className={styles.infoGrid}>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>SECRECY LEVEL</div>
                    <div className={styles.infoValue}>MAXIMUM</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>TECHNOLOGY LEVEL</div>
                    <div className={styles.infoValue}>A+</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>SECTOR TRUST</div>
                    <div className={styles.infoValue}>LOW</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>OBSERVATION STATUS</div>
                    <div className={styles.infoValue}>ACTIVE</div>
                  </div>
                </div>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>SECRECY: </span>большинство проектов строго засекречены, а отчёты о миссиях зашифрованы даже для межзвёздных советов.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>ADVANCED TECHNOLOGIES: </span>первые разработчики синтетических ядер памяти, позволяющих кораблям &quot;учиться&quot; в полёте.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>LOW TRUST LEVEL: </span>среди исследовательских фракций ходят слухи, что Adnexus проводит эксперименты с квантовыми структурами вне юридической зоны действия галактических конвенций.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>GHOST FLEET: </span>предполагается существование скрытой автономной флотилии, путешествующей без экипажей под управлением самосовершенствующихся ИИ.
                </p>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>ADNOS PROJECT</h3>
                <p className={styles.missionText}>
                  Проект Adnos считается венцом программы &quot;Nexo-Key&quot;, задачей которой было создать судно, способное не просто исследовать, но и взаимодействовать с аномальными структурами вне известных моделей физики.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.warningText}>STATUS: </span>По официальной версии корабль считается утерянным, покинувшим пределы звёздной карты.
                </p>
                
                {/* Секретная информация, которая появляется только после ввода команды ADNOS SIGNAL */}
                {secretInfoRevealed && (
                  <>
                    <p className={styles.missionText}>
                      Только что зафиксирован слабый, фрагментированный сигнал из сектора 12-A спустя 3.7 цикла после исчезновения Adnos.
                    </p>
                    <p className={styles.missionText}>
                      Сигнал содержит аномальную структуру — не только цифровую, но, что конкретно не так пока неясно. Последовательность кодов указывает на вмешательство ИИ первого уровня — предположительно ядра Isiris.
                    </p>
                    <p className={styles.missionText}>
                      <span className={styles.warningText}>WARNING: </span>Данная информация имеет гриф SL-4. Несанкционированный доступ преследуется по закону о межзвёздной безопасности.
                    </p>
                  </>
                )}
              </div>
            </>
          ) : activeTab === 'sector' ? (
            <>
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>SECTOR 12-A: GENERAL INFORMATION</h3>
                <p className={styles.missionText}>
                  Сектор 12-A является одним из самых малоизученных регионов в радиусе 500 световых лет от Земли. Особый интерес представляет высокая концентрация разнообразных звездных объектов и аномалий.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>СТАТУС ИССЛЕДОВАНИЯ:</span> Начальная фаза (5.7%)
                </p>
                <p className={styles.missionText}>
                  <span className={styles.highlightText}>ПРОГНОЗИРУЕМОЕ ВРЕМЯ ЗАВЕРШЕНИЯ КАРТОГРАФИРОВАНИЯ:</span> 183.4 дня
                </p>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>SECTOR CHARACTERISTICS</h3>
                <div className={styles.infoGrid}>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>ПЛОТНОСТЬ ЗВЁЗД</div>
                    <div className={styles.infoValue}>147% от средней</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>ОБНАРУЖЕНО ОБЪЕКТОВ</div>
                    <div className={styles.infoValue}>3,784</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>КАТАЛОГИЗИРОВАНО</div>
                    <div className={styles.infoValue}>216 (5.7%)</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>РЕДКИХ ТИПОВ ЗВЁЗД</div>
                    <div className={styles.infoValue}>18</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>АНОМАЛИЙ</div>
                    <div className={styles.infoValue}>7 [ЗАСЕКРЕЧЕНО]</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>ПОТЕНЦИАЛЬНО ОБИТАЕМЫХ ЗОН</div>
                    <div className={styles.infoValue}>12+</div>
                  </div>
                </div>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>NOTES & WARNINGS</h3>
                <p className={styles.missionText}>
                  Сектор 12-A отличается необычно высокой концентрацией звездных аномалий и объектов, не поддающихся стандартной классификации. Рекомендуется соблюдать особую осторожность при исследовании.
                </p>
                <p className={styles.missionText}>
                  В квадрате 400-720 зафиксированы необычные колебания фонового излучения. Предположительно, это связано с неизученными аномальными явлениями звёзд квадрата, однако требуется дополнительная проверка.
                </p>
                <p className={styles.missionText}>
                  <span className={styles.warningText}>ПРЕДУПРЕЖДЕНИЕ:</span> При обнаружении объектов с маркировкой [АНОМАЛИЯ] немедленно сообщить в центр управления и не приближаться к объекту.
                </p>
              </div>
            </>
          ) : activeTab === 'sectors-map' ? (
            <>
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>GALACTIC SECTORS VISUALIZATION</h3>
                <p className={styles.missionText}>
                  Interactive map of known sectors in local region. Sector 12-A is highlighted as current explored area.
                </p>
              </div>
              
              <div className={styles.infoSection}>
                <div className={styles.sectorsMapContainer}>
                  <SectorsMap />
                  <div className={styles.mapLegend}>
                    <div className={styles.legendItem}>
                      <span className={styles.legendColor} style={{backgroundColor: 'rgba(72, 255, 237, 0.7)'}}></span>
                      <span className={styles.legendText}>CURRENT POSITION</span>
                    </div>
                    <div className={styles.legendItem}>
                      <span className={styles.legendColor} style={{backgroundColor: 'rgba(255, 255, 255, 0.3)'}}></span>
                      <span className={styles.legendText}>EXPLORED SECTORS</span>
                    </div>
                    <div className={styles.legendItem}>
                      <span className={styles.legendColor} style={{backgroundColor: 'rgba(64, 153, 255, 0.4)'}}></span>
                      <span className={styles.legendText}>REGISTERED SECTORS</span>
                    </div>
                    <div className={styles.legendItem}>
                      <span className={styles.legendColor} style={{backgroundColor: 'rgba(255, 56, 96, 0.4)'}}></span>
                      <span className={styles.legendText}>RESTRICTED SECTORS</span>
                    </div>
                    <div className={styles.legendItem}>
                      <span className={styles.legendColor} style={{backgroundColor: 'rgba(180, 90, 255, 0.7)'}}></span>
                      <span className={styles.legendText}>ANOMALOUS SECTOR 12-A</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>NAVIGATION DATA</h3>
                <div className={styles.infoGrid}>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>CURRENT SECTOR</div>
                    <div className={styles.infoValue}>12-A</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>QUADRANT</div>
                    <div className={styles.infoValue}>ORION-3</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>DISTANCE FROM HQ</div>
                    <div className={styles.infoValue}>127.3 LY</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>NEAREST OUTPOST</div>
                    <div className={styles.infoValue}>WAYPOINT XI</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>OUTPOST DISTANCE</div>
                    <div className={styles.infoValue}>42.8 LY</div>
                  </div>
                  <div className={styles.infoItem}>
                    <div className={styles.infoLabel}>COMMS LATENCY</div>
                    <div className={styles.infoValue}>18.6 HR</div>
                  </div>
                </div>
              </div>
            </>
          ) : activeTab === 'sectors-info' ? (
            <div className={styles.sectorsInfoContainer}>
              <div className={styles.sectorsList}>
                <h3 className={styles.sectionTitle}>ДОСТУПНЫЕ СЕКТОРА</h3>
                <div className={styles.sectorsGrid}>
                  {sectorsData.map(sector => (
                    <div 
                      key={sector.id}
                      className={`${styles.sectorItem} ${selectedSector && selectedSector.id === sector.id ? styles.activeSector : ''} ${styles[sector.type]}`}
                      onClick={() => {
                        playCliSound();
                        setSelectedSector(sector);
                      }}
                    >
                      <div className={styles.sectorId}>{sector.id}</div>
                      <div className={styles.sectorStatus}>{sector.status}</div>
                    </div>
                  ))}
                </div>
              </div>
              
              {selectedSector ? (
                <div className={styles.sectorDetailContainer}>
                  <div className={`${styles.sectorDetailHeader} ${styles[selectedSector.type]}`}>
                    <h3 className={styles.sectorDetailTitle}>{selectedSector.name.toUpperCase()}</h3>
                    <div className={styles.sectorDetailType}>
                      <span className={styles.sectorLabel}>ТИП:</span> 
                      {selectedSector.type.toUpperCase()}
                    </div>
                    <div className={styles.sectorDetailStatus}>
                      <span className={styles.sectorLabel}>СТАТУС:</span> 
                      {selectedSector.status}
                    </div>
                  </div>
                  
                  <div className={styles.sectorDetailContent}>
                    <div className={styles.sectorDescriptionContainer}>
                      {/* Splitting the description to separate connections section */}
                      {selectedSector.fullDescription.includes('Связи:') ? (
                        <>
                          <div className={styles.sectorMainDescription}>
                            <p className={styles.sectorDescription}>
                              {selectedSector.fullDescription.split('Связи:')[0]}
                            </p>
                          </div>
                          
                          <div className={styles.sectorConnectionsPanel}>
                            <div className={styles.sectorConnectionsHeader}>
                              <div className={styles.connectionIcon}></div>
                              <h4 className={styles.connectionsTitle}>СВЯЗИ С ДРУГИМИ СЕКТОРАМИ</h4>
                            </div>
                            <div className={styles.connectionsContent}>
                              {selectedSector.fullDescription.split('Связи:')[1].split('\n').filter(conn => conn.trim()).map((connection, index) => (
                                <div key={index} className={styles.connectionItem}>
                                  <div className={styles.connectionBullet}></div>
                                  <p>{connection.trim()}</p>
                                </div>
                              ))}
                            </div>
                          </div>
                        </>
                      ) : (
                        <p className={styles.sectorDescription}>{selectedSector.fullDescription}</p>
                      )}
                    </div>
                    
                    <div className={styles.sectorDetailInfo}>
                      <div className={styles.sectorInfoPanel}>
                        <div className={styles.sectorInfoPanelHeader}>
                          <h4 className={styles.panelTitle}>ИНФОРМАЦИЯ О СЕКТОРЕ</h4>
                        </div>
                        
                        <div className={styles.sectorInfoItem}>
                          <span className={styles.sectorInfoLabel}>ИССЛЕДОВАТЕЛЬСКАЯ ГРУППА:</span>
                          <span className={styles.sectorInfoValue}>
                            {selectedSector.id === '11-B' ? 'Экспедиционный корпус "Горизонт"' : 
                             selectedSector.id === '13-B' ? 'Оперативная группа "Чистильщик"' : 
                             selectedSector.id === '10-C' ? 'Патрульная служба "Транзит"' : 
                             selectedSector.id === '14-A' ? 'Корпорация "Helios-Tech"' :
                             selectedSector.id === '9-D' ? 'Корпорация "Nova-Mine"' : 
                             selectedSector.id === '15-B' ? 'Навигационный центр "Орион"' : 
                             selectedSector.id === '16-C' ? 'Консорциум "Quantum-Ark"' : 
                             selectedSector.id === '8-A' ? 'Научная станция "Пульсар-4"' : 
                             selectedSector.id === '17-D' ? 'Комитет навигационной безопасности' :
                             selectedSector.id === '7-B' ? 'Навигационная служба "Сигма"' :
                             selectedSector.id === '18-A' ? 'Объединенный флот корпораций' :
                             selectedSector.id === '19-C' ? 'Научно-исследовательский центр "Ксенология"' : 
                             selectedSector.id === '20-D' ? 'Торговый альянс "Нексус"' :
                             selectedSector.id === '21-A' ? 'Специальный отдел "Гравитационные исследования"' :
                             selectedSector.id === '22-B' ? 'Астрономическое общество "Стеллар"' : 'Ожидание данных...'}
                          </span>
                        </div>
                        <div className={styles.sectorInfoItem}>
                          <span className={styles.sectorInfoLabel}>ПРИОРИТЕТ:</span>
                          <span className={styles.sectorInfoValue}>
                            {selectedSector.id === '11-B' ? 'ВЫСОКИЙ' : 
                             selectedSector.id === '13-B' ? 'СРЕДНИЙ (КОНТРОЛЬ)' : 
                             selectedSector.id === '10-C' ? 'НИЗКИЙ (РЕГУЛЯРНЫЙ НАДЗОР)' : 
                             selectedSector.id === '14-A' ? 'ВЫСОКИЙ (СТРАТЕГИЧЕСКИЙ ОБЪЕКТ)' :
                             selectedSector.id === '9-D' ? 'ВЫСОКИЙ (ПРОМЫШЛЕННОЕ ЗНАЧЕНИЕ)' : 
                             selectedSector.id === '15-B' ? 'СРЕДНИЙ (НАВИГАЦИОННЫЙ УЗЕЛ)' : 
                             selectedSector.id === '16-C' ? 'ВЫСШИЙ (СЕКРЕТНЫЙ)' : 
                             selectedSector.id === '8-A' ? 'ВЫСОКИЙ (НАУЧНОЕ ЗНАЧЕНИЕ)' : 
                             selectedSector.id === '17-D' ? 'НИЗКИЙ (ОПАСНАЯ ЗОНА)' :
                             selectedSector.id === '7-B' ? 'НИЗКИЙ (НАВИГАЦИОННЫЙ ИНТЕРЕС)' :
                             selectedSector.id === '18-A' ? 'ВЫСОКИЙ (БЕЗОПАСНОСТЬ)' :
                             selectedSector.id === '19-C' ? 'ВЫСОКИЙ (ИСТОРИЧЕСКИЙ АРТЕФАКТ)' : 
                             selectedSector.id === '20-D' ? 'НИЗКИЙ (КОММЕРЧЕСКИЙ ИНТЕРЕС)' :
                             selectedSector.id === '21-A' ? 'КРИТИЧЕСКИЙ (ОПАСНОСТЬ)' :
                             selectedSector.id === '22-B' ? 'СРЕДНИЙ (НАУЧНЫЙ ИНТЕРЕС)' : 'Ожидание данных...'}
                          </span>
                        </div>
                        <div className={styles.sectorInfoItem}>
                          <span className={styles.sectorInfoLabel}>КОДОВОЕ НАЗВАНИЕ:</span>
                          <span className={styles.sectorInfoValue}>
                            {selectedSector.id === '11-B' ? 'Проект "Ойкумена"' : 
                             selectedSector.id === '13-B' ? 'Операция "Змеиное гнездо"' : 
                             selectedSector.id === '10-C' ? 'Программа "Транзитный коридор"' : 
                             selectedSector.id === '14-A' ? 'Проект "Бастион"' :
                             selectedSector.id === '9-D' ? 'Проект "Феррон"' : 
                             selectedSector.id === '15-B' ? 'Проект "Компас"' : 
                             selectedSector.id === '16-C' ? 'Проект "Разлом"' : 
                             selectedSector.id === '8-A' ? 'Проект "Двойная звезда"' : 
                             selectedSector.id === '17-D' ? 'Проект "Каменный лабиринт"' :
                             selectedSector.id === '7-B' ? 'Проект "Чистое небо"' :
                             selectedSector.id === '18-A' ? 'Операция "Часовой"' :
                             selectedSector.id === '19-C' ? 'Проект "Наследие"' : 
                             selectedSector.id === '20-D' ? 'Программа "Перекресток"' :
                             selectedSector.id === '21-A' ? 'Проект "Черная призма"' :
                             selectedSector.id === '22-B' ? 'Проект "Обсерватория"' : 'Ожидание данных...'}
                          </span>
                        </div>
                        <div className={styles.sectorInfoItem}>
                          <span className={styles.sectorInfoLabel}>ДАТА РЕГИСТРАЦИИ:</span>
                          <span className={styles.sectorInfoValue}>
                            {selectedSector.id === '11-B' ? '07.03.2181' : 
                             selectedSector.id === '13-B' ? '19.11.2177' : 
                             selectedSector.id === '10-C' ? '14.06.2168' : 
                             selectedSector.id === '14-A' ? '23.09.2172' :
                             selectedSector.id === '9-D' ? '02.12.2174' : 
                             selectedSector.id === '15-B' ? '28.04.2170' : 
                             selectedSector.id === '16-C' ? '10.08.2179' : 
                             selectedSector.id === '8-A' ? '15.05.2174' : 
                             selectedSector.id === '17-D' ? '03.08.2175' :
                             selectedSector.id === '7-B' ? '19.02.2166' :
                             selectedSector.id === '18-A' ? '05.10.2169' :
                             selectedSector.id === '19-C' ? '22.07.2180' : 
                             selectedSector.id === '20-D' ? '11.03.2171' :
                             selectedSector.id === '21-A' ? '29.01.2176' :
                             selectedSector.id === '22-B' ? '18.12.2167' : 'Ожидание данных...'}
                          </span>
                        </div>
                      </div>
                    </div>
                    
                    <div className={styles.sectorNotes}>
                      <div className={styles.sectorNotesHeader}>
                        <div className={styles.noteIcon}></div>
                        <h4 className={styles.sectorNotesTitle}>ПРИМЕЧАНИЯ:</h4>
                      </div>
                      <p className={styles.sectorNoteText}>
                        {selectedSector.id === '11-B' ? 'Системы Ксавир и Эридан требуют дополнительного обследования. Зафиксированы нестабильные гравитационные показатели в кольцевой системе третьей планеты Эридана. Рекомендована осторожность при навигации.' : 
                         selectedSector.id === '13-B' ? 'Доступ ограничен в связи с криминальной активностью. Рекомендовано передвижение с вооруженным эскортом. Особая опасность в районе станции "Кровавая Спайка". Сигналы бедствия могут быть ловушками пиратов.' : 
                         selectedSector.id === '10-C' ? 'Рекомендуется соблюдать повышенную бдительность при пролёте через астероидные поля. Маршруты через секторы Дельта-2 и Гамма-3 патрулируются регулярно. Станция "Транзит-7" предлагает скидки на топливо для исследовательских кораблей по коду ADNOS-INT.' : 
                         selectedSector.id === '14-A' ? 'Посещение Опорного Пункта II требует предварительного получения разрешения. Корабли ADNOS имеют привилегированный статус. Доступ к некоторым зонам станции ограничен даже для исследовательских судов. Не рекомендуется приближаться к южному доку без специального разрешения.' :
                         selectedSector.id === '9-D' ? 'Высокие уровни радиации в секторе. Требуется дополнительная защита корабля. Фиксируются активности автоматизированных дронов неизвестного происхождения, нападающих на добывающие станции. При обнаружении древних артефактов немедленно сообщать в командный центр.' : 
                         selectedSector.id === '15-B' ? 'Сектор идеален для калибровки навигационных систем. Автоматическая станция "Орион-К" работает круглосуточно, но возможны периодические технические работы. При обнаружении аномалий в навигационных сигналах немедленно сообщать в центр безопасности. Защищенный канал связи: NAV-15B-SECURE.' : 
                         selectedSector.id === '16-C' ? 'ДОСТУП СТРОГО ОГРАНИЧЕН. Вход в сектор разрешён только авторизованным кораблям консорциума "Quantum-Ark". Несанкционированное проникновение приведёт к активации автоматической системы защиты. Зафиксированы случаи пространственно-временных искажений и аномалий связи. Высший уровень секретности.' : 
                         selectedSector.id === '8-A' ? 'ВНИМАНИЕ: Опасные уровни радиации вблизи системы B-99. Обязательное использование экранированных щитов класса R+. Предупреждение о возможных сбоях оборудования при приближении к нейтронным звездам. Странные сигналы временами регистрируются станцией "Пульсар-4", требуется дополнительное исследование.' : 
                         selectedSector.id === '17-D' ? 'КРАЙНЯЯ ОСТОРОЖНОСТЬ! Астероидные поля с непредсказуемыми траекториями. Необходимо активное маневрирование и постоянный мониторинг сенсоров. Нестабильная связь через станцию "Эхо-9". Неидентифицированные сигналы зафиксированы в глубинах полей. Запрещено приближение к подозрительным объектам без специального оборудования.' :
                         selectedSector.id === '7-B' ? 'Идеальное пространство для навигационных расчётов благодаря низкой плотности космических объектов. Маяк "Сигма-3" обеспечивает стабильный сигнал для корректировки маршрутов. При обнаружении необъяснимых радиопомех рекомендуется фиксировать время и координаты для дальнейшего исследования источника.' :
                         selectedSector.id === '18-A' ? 'ВНИМАНИЕ: Обязательная регистрация при входе в сектор. Корабли должны следовать по одобренным маршрутам и поддерживать открытые каналы связи. Несоблюдение протоколов приведет к задержанию. Все грузы подлежат сканированию. "Аванпост Кси" может запросить стыковку для внепланового досмотра. Коды сближения меняются каждые 12 часов.' :
                         selectedSector.id === '19-C' ? 'КАРАНТИННАЯ ЗОНА. Несанкционированный вход в сектор запрещен. При контакте с артефактами требуется полная изоляция и последующий карантин. Магнитные аномалии могут вызывать отказы систем корабля. Платформа "Реликт-12" находится под постоянным наблюдением. Запрещен вывоз любых артефактов, найденных в секторе. Нарушители будут преследоваться по закону.' :
                         selectedSector.id === '20-D' ? 'Станция "Нексус-5" предлагает стандартные услуги заправки и ремонта по средним рыночным ценам. Рекомендуется проверять счета и контракты на наличие скрытых комиссий. При обнаружении подозрительной активности обращаться к офицеру безопасности на уровне 3. Станция работает круглосуточно, но некоторые сервисы могут быть недоступны в нерабочие часы (02:00-06:00 по стандартному времени).' :
                         selectedSector.id === '21-A' ? 'ЗАПРЕЩЕННАЯ ЗОНА! МАКСИМАЛЬНАЯ ОПАСНОСТЬ! Вход в сектор строго запрещен без специального разрешения высшего уровня. Все навигационные системы должны быть перепрограммированы для автоматического облета зоны на безопасном расстоянии. Зонды-разведчики допускаются только с одобрения Специального отдела. При обнаружении аномальных гравитационных показателей немедленно увеличить расстояние до источника. Эвакуация в случае повреждений корабля может быть невозможна из-за искажений пространства.' :
                         selectedSector.id === '22-B' ? 'Обсерватория "Стеллар-7" принимает заявки на научные визиты с предварительным уведомлением за 30 дней. Некоторые данные телескопов имеют ограниченный доступ (уровень допуска S-3 или выше). Сектор отлично подходит для астрономических наблюдений благодаря низкому уровню космического шума. Исследователям рекомендуется воздерживаться от использования импульсных двигателей вблизи обсерватории из-за возможных помех наблюдениям.' : 'Ожидание данных...'}
                      </p>
                    </div>
                  </div>
                </div>
              ) : (
                <div className={styles.sectorPlaceholder}>
                  <p>Выберите сектор для просмотра подробной информации</p>
                </div>
              )}
            </div>
          ) : activeTab === 'companies' ? (
            <div className={styles.companiesContainer}>
              <div className={styles.companiesTabsContainer}>
                <button 
                  className={`${styles.companyTabButton} ${activeCompany === 'helios-tech' ? styles.activeCompanyTab : ''}`} 
                  onClick={() => handleCompanyChange('helios-tech')}
                >
                  HELIOS-TECH
                </button>
                <button 
                  className={`${styles.companyTabButton} ${activeCompany === 'nova-mine' ? styles.activeCompanyTab : ''}`} 
                  onClick={() => handleCompanyChange('nova-mine')}
                >
                  NOVA-MINE
                </button>
                <button 
                  className={`${styles.companyTabButton} ${activeCompany === 'quantum-ark' ? styles.activeCompanyTab : ''}`} 
                  onClick={() => handleCompanyChange('quantum-ark')}
                >
                  QUANTUM-ARK
                </button>
                <button 
                  className={`${styles.companyTabButton} ${activeCompany === 'serpent-ring' ? styles.activeCompanyTab : ''}`} 
                  onClick={() => handleCompanyChange('serpent-ring')}
                >
                  SERPENT RING CARTEL
                </button>
              </div>
              
              <div className={styles.companyContent}>
                {activeCompany === 'helios-tech' && (
                  <div className={styles.companySection}>
                    <h3 className={styles.sectionTitle}>HELIOS-TECH CORPORATION</h3>
                    <div className={styles.companyInfo}>
                      <div className={styles.companyHeader}>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ТИП:</span>
                          <span className={styles.infoValue}>Технологическая корпорация</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ОСНОВАНА:</span>
                          <span className={styles.infoValue}>2167</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ШТАБ-КВАРТИРА:</span>
                          <span className={styles.infoValue}>Опорный Пункт II (Сектор 14-A)</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>СТАТУС:</span>
                          <span className={styles.infoValue}>Активна</span>
                        </div>
                      </div>
                      
                      <div className={styles.companyDescription}>
                        <p>
                          Helios-Tech — ведущая корпорация, специализирующаяся на обслуживании космических кораблей и технических услугах. Управляет высокозащищёнными объектами, такими как Опорный Пункт II в секторе 14-A, предоставляя ремонт, заправку и анализ данных для исследовательских судов.
                        </p>
                        <p>
                          Компания известна строгим контролем доступа к своим объектам и высокими ценами на услуги, что вызывает недовольство многих клиентов. Несмотря на это, качество работы инженеров Helios-Tech считается непревзойденным в отрасли.
                        </p>
                        <p>
                          Среди исследователей ходят слухи о секретных экспериментах с ксено-технологиями, проводимых в закрытых лабораториях корпорации. Официальные представители Helios-Tech отрицают эти обвинения.
                        </p>
                        <p>
                          Влияние компании охватывает несколько секторов благодаря собственным уникальным технологиям и стратегически расположенным станциям. Корпорация активно расширяет свое присутствие, особенно в зонах с высокой исследовательской активностью.
                        </p>
                      </div>
                      
                      <div className={styles.companyMetricsGrid}>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ТЕХНОЛОГИЧЕСКИЙ УРОВЕНЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '87%' }}></div>
                          </div>
                          <div className={styles.metricValue}>87%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>БЕЗОПАСНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '92%' }}></div>
                          </div>
                          <div className={styles.metricValue}>92%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>РЕПУТАЦИЯ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '74%' }}></div>
                          </div>
                          <div className={styles.metricValue}>74%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ДОСТУПНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '45%' }}></div>
                          </div>
                          <div className={styles.metricValue}>45%</div>
                        </div>
                      </div>
                      
                      <div className={styles.companyConnections}>
                        <h4 className={styles.connectionsTitle}>СВЯЗИ С СЕКТОРАМИ:</h4>
                        <ul className={styles.connectionsList}>
                          <li><strong>14-A:</strong> Основная операционная база (Опорный Пункт II)</li>
                          <li><strong>11-B:</strong> Обслуживание колонизационных экспедиций по завышенным ценам</li>
                          <li><strong>10-C:</strong> Контроль ключевых транзитных маршрутов для поставки запчастей</li>
                          <li><strong>8-A:</strong> Техническая поддержка научной станции &quot;Пульсар-4&quot;</li>
                          <li><strong>16-C:</strong> Предполагаемое тайное сотрудничество с консорциумом &quot;Quantum-Ark&quot;</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
                
                {activeCompany === 'nova-mine' && (
                  <div className={styles.companySection}>
                    <h3 className={styles.sectionTitle}>NOVA-MINE CORPORATION</h3>
                    <div className={styles.companyInfo}>
                      <div className={styles.companyHeader}>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ТИП:</span>
                          <span className={styles.infoValue}>Добывающий конгломерат</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ОСНОВАНА:</span>
                          <span className={styles.infoValue}>2173</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ШТАБ-КВАРТИРА:</span>
                          <span className={styles.infoValue}>Феррон (Сектор 9-D)</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>СТАТУС:</span>
                          <span className={styles.infoValue}>Активна</span>
                        </div>
                      </div>
                      
                      <div className={styles.companyDescription}>
                        <p>
                          Nova-Mine — крупный конгломерат по добыче ресурсов, специализирующийся на редких металлах, таких как тританиум и осмирий, необходимых для строительства космических кораблей и брони высокого класса. Основной центр деятельности компании находится в секторе 9-D, который богат ресурсами, но опасен из-за радиации.
                        </p>
                        <p>
                          Компания разворачивает автоматизированные добывающие платформы на таких мирах, как суровый вулканический Феррон, несмотря на высокую радиацию и непредсказуемые магнитные поля. Особую угрозу представляют атаки древних дронов-охранников, предположительно оставленных исчезнувшей цивилизацией.
                        </p>
                        <p>
                          Nova-Mine известна своей философией &quot;эффективность любой ценой&quot;, что часто приводит к пренебрежению безопасностью и экологическими стандартами. Компания сталкивается с постоянными проблемами пиратства, нестабильными условиями добычи и техническими сбоями оборудования.
                        </p>
                        <p>
                          Агрессивная экспансия Nova-Mine в новые астероидные поля и на планеты с богатыми месторождениями вызывает конфликты с местными исследовательскими организациями, колониями и конкурирующими добывающими компаниями. Однако их монополия на ключевые металлы делает их незаменимыми для космического судостроения.
                        </p>
                      </div>
                      
                      <div className={styles.companyMetricsGrid}>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ТЕХНОЛОГИЧЕСКИЙ УРОВЕНЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '78%' }}></div>
                          </div>
                          <div className={styles.metricValue}>78%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>БЕЗОПАСНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '42%' }}></div>
                          </div>
                          <div className={styles.metricValue}>42%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>РЕПУТАЦИЯ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '56%' }}></div>
                          </div>
                          <div className={styles.metricValue}>56%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ДОСТУПНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '68%' }}></div>
                          </div>
                          <div className={styles.metricValue}>68%</div>
                        </div>
                      </div>
                      
                      <div className={styles.companyConnections}>
                        <h4 className={styles.connectionsTitle}>СВЯЗИ С СЕКТОРАМИ:</h4>
                        <ul className={styles.connectionsList}>
                          <li><strong>9-D:</strong> Основная операционная база (планета Феррон)</li>
                          <li><strong>11-B:</strong> Поставка материалов для колонизации и строительства баз</li>
                          <li><strong>17-D:</strong> Разведка астероидных полей как запасных мест добычи</li>
                          <li><strong>13-B:</strong> Конфликты с контрабандистами, ворующими металлы и технологии</li>
                          <li><strong>14-A:</strong> Контракты на обслуживание буровой техники с Helios-Tech</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
                
                {activeCompany === 'quantum-ark' && (
                  <div className={styles.companySection}>
                    <h3 className={styles.sectionTitle}>QUANTUM-ARK CONSORTIUM</h3>
                    <div className={styles.companyInfo}>
                      <div className={styles.companyHeader}>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ТИП:</span>
                          <span className={styles.infoValue}>Исследовательский консорциум</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ОСНОВАН:</span>
                          <span className={styles.infoValue}>2178</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ШТАБ-КВАРТИРА:</span>
                          <span className={styles.infoValue}>Орбитальные лаборатории (Сектор 16-C)</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>СТАТУС:</span>
                          <span className={styles.infoValue}>Засекречен</span>
                        </div>
                      </div>
                      
                      <div className={styles.companyDescription}>
                        <p>
                          Quantum-Ark — засекреченный исследовательский консорциум, проводящий несанкционированные эксперименты с квантовыми структурами в секторе 16-C. Официальная цель консорциума — &quot;расширение границ понимания фундаментальных законов вселенной&quot;, однако реальная деятельность скрыта за множеством уровней секретности.
                        </p>
                        <p>
                          Консорциум управляет сетью орбитальных лабораторий, расположенных вокруг небольшой планеты в секторе 16-C, где проводятся исследования квантовых аномалий и искажений пространства-времени. Основная цель — создание новых источников энергии, способных революционизировать космические перелёты и межзвёздную экспансию.
                        </p>
                        <p>
                          Все объекты Quantum-Ark строго охраняются автономными дронами с продвинутыми системами защиты. Несанкционированное приближение к лабораториям заканчивается немедленным уничтожением нарушителей без предупреждения. Утечки информации от бывших сотрудников намекают на разработку нестабильных прототипов, способных вызывать локальные искажения реальности.
                        </p>
                        <p>
                          Несмотря на официальный запрет на их исследования со стороны галактических властей, Quantum-Ark продолжает работу благодаря влиятельным покровителям и изолированному местоположению. Существуют обоснованные подозрения, что консорциум тайно продаёт экспериментальные технологии на чёрном рынке для финансирования своей деятельности.
                        </p>
                      </div>
                      
                      <div className={styles.companyMetricsGrid}>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ТЕХНОЛОГИЧЕСКИЙ УРОВЕНЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '94%' }}></div>
                          </div>
                          <div className={styles.metricValue}>94%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>БЕЗОПАСНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '97%' }}></div>
                          </div>
                          <div className={styles.metricValue}>97%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>РЕПУТАЦИЯ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '38%' }}></div>
                          </div>
                          <div className={styles.metricValue}>38%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ДОСТУПНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '15%' }}></div>
                          </div>
                          <div className={styles.metricValue}>15%</div>
                        </div>
                      </div>
                      
                      <div className={styles.companyConnections}>
                        <h4 className={styles.connectionsTitle}>СВЯЗИ С СЕКТОРАМИ:</h4>
                        <ul className={styles.connectionsList}>
                          <li><strong>16-C:</strong> Основная операционная база (орбитальные лаборатории)</li>
                          <li><strong>21-A:</strong> Тайное изучение гравитационных аномалий чёрной дыры</li>
                          <li><strong>13-B:</strong> Предполагаемая торговля экспериментальными технологиями через чёрный рынок</li>
                          <li><strong>8-A:</strong> Интерес к сигналам системы B-99 и данным станции &quot;Пульсар-4&quot;</li>
                          <li><strong>19-C:</strong> Попытки получить доступ к артефактам древней цивилизации для исследований</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
                
                {activeCompany === 'serpent-ring' && (
                  <div className={styles.companySection}>
                    <h3 className={styles.sectionTitle}>SERPENT RING CARTEL</h3>
                    <div className={styles.companyInfo}>
                      <div className={styles.companyHeader}>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ТИП:</span>
                          <span className={styles.infoValue}>Преступный синдикат</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ОСНОВАН:</span>
                          <span className={styles.infoValue}>2177</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>ШТАБ-КВАРТИРА:</span>
                          <span className={styles.infoValue}>&quot;Кровавая Спайка&quot; (Сектор 13-B)</span>
                        </div>
                        <div className={styles.companyHeaderItem}>
                          <span className={styles.infoLabel}>СТАТУС:</span>
                          <span className={styles.infoValue}>Вне закона</span>
                        </div>
                      </div>
                      
                      <div className={styles.companyDescription}>
                        <p>
                          Serpent Ring Cartel — мощный преступный синдикат, доминирующий в секторе 13-B и распространяющий своё влияние на соседние регионы. Группировка специализируется на контрабанде редких ресурсов, торговле крадеными технологиями и содержании обширной сети чёрных рынков в нерегулируемых зонах галактики.
                        </p>
                        <p>
                          Основным оплотом синдиката является орбитальная станция &quot;Кровавая Спайка&quot; — центр незаконной торговли, где можно купить и продать практически всё: от ксеноминералов из запретных секторов до секретных данных корпораций и правительственных организаций. Станция печально известна своими жестокими законами и системой &quot;залогов жизни&quot; для посетителей.
                        </p>
                        <p>
                          Картель мастерски использует естественные навигационные помехи сектора 13-B и многочисленные астероидные поля для укрытия своих тайных баз и складов. Их корабли оснащены передовыми системами маскировки, часто украденными или модифицированными из военных прототипов.
                        </p>
                        <p>
                          Несмотря на постоянные конфликты с патрулями безопасности из сектора 18-A и стычки с корпоративными службами безопасности, Serpent Ring Cartel поддерживает обширную сеть информаторов и коррумпированных чиновников, что позволяет им оставаться в тени и продолжать свою деятельность. Ходят слухи о таинственном &quot;Маяке&quot; — секретной базе, где за огромные деньги продают самые опасные секреты галактики.
                        </p>
                      </div>
                      
                      <div className={styles.companyMetricsGrid}>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ТЕХНОЛОГИЧЕСКИЙ УРОВЕНЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '68%' }}></div>
                          </div>
                          <div className={styles.metricValue}>68%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>СКРЫТНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '89%' }}></div>
                          </div>
                          <div className={styles.metricValue}>89%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ОПАСНОСТЬ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '93%' }}></div>
                          </div>
                          <div className={styles.metricValue}>93%</div>
                        </div>
                        <div className={styles.companyMetricItem}>
                          <div className={styles.metricLabel}>ВЛИЯНИЕ</div>
                          <div className={styles.metricBar}>
                            <div className={styles.metricFill} style={{ width: '72%' }}></div>
                          </div>
                          <div className={styles.metricValue}>72%</div>
                        </div>
                      </div>
                      
                      <div className={styles.companyConnections}>
                        <h4 className={styles.connectionsTitle}>СВЯЗИ С СЕКТОРАМИ:</h4>
                        <ul className={styles.connectionsList}>
                          <li><strong>13-B:</strong> Основная база операций (станция &quot;Кровавая Спайка&quot;)</li>
                          <li><strong>11-B:</strong> Кража минералов и артефактов с планеты Аурелия</li>
                          <li><strong>17-D:</strong> Использование астероидных полей для тайных складов и баз</li>
                          <li><strong>19-C:</strong> Контрабанда запрещенных артефактов древних цивилизаций</li>
                          <li><strong>18-A:</strong> Постоянные столкновения с патрулями &quot;Аванпоста Кси&quot;</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          ) : activeTab === 'reports' ? (
            <div className={styles.reportsContainer}>
              <div className={styles.infoSection}>
                <h3 className={styles.sectionTitle}>STAR OBJECT REPORTING SYSTEM</h3>
                <p className={styles.missionText}>
                  Используйте эту форму для отправки отчетов о неопознанных звездных объектах. Введите ID звезды и дополнительную информацию, чтобы помочь обновить наш звездный каталог.
                </p>
                
                {reportStatus === 'success' ? (
                  <div className={styles.reportSuccess}>
                    <div className={`${styles.successIcon} ${anomalySuccess ? styles.anomalySuccessIcon : ''}`}></div>
                    <h4>{anomalySuccess ? 'ANOMALY REPORT SUBMITTED' : 'REPORT SUBMITTED SUCCESSFULLY'}</h4>
                    {anomalySuccess ? (
                      <p className={styles.anomalySuccessText}>ВНИМАНИЕ: Отчет об аномалии зафиксирован. Ваш доклад передан в центр исследования аномальных объектов. Продолжайте наблюдение, но соблюдайте дистанцию безопасности.</p>
                    ) : pseudoStarSuccess ? (
                      <p>Благодарим за информацию о Псевдо-звезде! Ваши данные о солнечной системе представляют особую научную ценность и будут использованы для обновления звездных карт.</p>
                    ) : (
                      <p>Благодарим за вклад в звездный каталог ADNOS. Ваши данные записаны и будут проанализированы нашими системами.</p>
                    )}
                    <div className={styles.reportSuccessActions}>
                      <button 
                        className={styles.closeReportBtn} 
                        onClick={() => {
                          playCliSound();
                          resetReportForm();
                        }}
                      >
                        CLOSE
                      </button>
                    </div>
                  </div>
                ) : (
                  <form className={styles.reportForm} onSubmit={handleSubmitReport}>
                    <div className={`${styles.formGroup} ${starId ? styles.hasValue : ''}`}>
                      <label htmlFor="starId">STAR IDENTIFIER</label>
                      <div className={styles.inputWrapper}>
                        <input 
                          type="text" 
                          id="starId" 
                          value={starId} 
                          onChange={(e) => {
                            setStarId(e.target.value);
                            if (e.target.value && validationError) {
                              setValidationError('');
                            }
                          }} 
                          placeholder="#xxx_-x" 
                          className={validationError && validationError.includes('ID') ? styles.inputError : ''}
                          disabled={reportStatus === 'sending'}
                        />
                        <div className={styles.placeholderExamples}>
                          Примеры форматов: #xxx_-x | #xxxx_x | #-xxx_- | #-xxxx_ | #xxx_xx
                        </div>
                        {starId && <span className={styles.inputIndicator}></span>}
                      </div>
                    </div>
                    
                    <div className={`${styles.formGroup} ${pseudoStar ? styles.hasValue : ''}`}>
                      <label htmlFor="pseudoStar">PSEUDO-STAR IDENTIFIER</label>
                      <div className={styles.inputWrapper}>
                        <div className={styles.selectWrapper}>
                          <input 
                            type="text" 
                            id="pseudoStar" 
                            value={pseudoStar} 
                            onChange={(e) => setPseudoStar(e.target.value)} 
                            placeholder="Выберите псевдо-звезду" 
                            onClick={togglePseudoStarDropdown}
                            disabled={reportStatus === 'sending'}
                            ref={pseudoStarInputRef}
                          />
                          {/* Удаляем кнопку со стрелкой, которая мешает */}
                          {/* <div 
                            className={styles.dropdownButton} 
                            onClick={togglePseudoStarDropdown}
                          >
                            {showPseudoStarDropdown ? '▲' : '▼'}
                          </div> */}
                          
                          {/* Используем новый компонент-портал вместо встроенного выпадающего списка */}
                          <PseudoStarDropdown 
                            isOpen={showPseudoStarDropdown}
                            onSelect={handlePseudoStarSelect}
                            items={ALLOWED_PSEUDO_STARS}
                            position={pseudoStarDropdownPosition}
                          />
                        </div>
                        <div className={styles.placeholderExamples}>
                          Выберите название из списка (20 доступных звезд)
                        </div>
                        {pseudoStar && <span className={styles.inputIndicator}></span>}
                      </div>
                    </div>
                    
                    <div className={`${styles.formGroup} ${anomalyId ? styles.hasValue : ''}`}>
                      <label htmlFor="anomalyId">ANOMALY REPORT</label>
                      <div className={styles.inputWrapper}>
                        <input 
                          type="text" 
                          id="anomalyId" 
                          value={anomalyId} 
                          onChange={(e) => {
                            setAnomalyId(e.target.value);
                            if (e.target.value && validationError && validationError.includes('аномалии')) {
                              setValidationError('');
                            }
                          }} 
                          placeholder="[АНОМАЛИЯ]" 
                          className={validationError && validationError.includes('формат аномалии') ? styles.inputError : ''}
                          disabled={reportStatus === 'sending'}
                        />
                        <div className={styles.placeholderExamples}>
                          Формат: [АНОМАЛИЯ]
                        </div>
                        {anomalyId && <span className={styles.inputIndicator}></span>}
                      </div>
                    </div>
                    
                    <div className={`${styles.formGroup} ${reportField2 ? styles.hasValue : ''}`}>
                      <label htmlFor="reportField2">ADDITIONAL NOTES</label>
                      <textarea 
                        id="reportField2" 
                        value={reportField2} 
                        onChange={(e) => setReportField2(e.target.value)} 
                        placeholder="Любая дополнительная информация о звездном объекте..."
                        disabled={reportStatus === 'sending'}
                      ></textarea>
                      {reportField2 && <span className={styles.textareaIndicator}></span>}
                    </div>
                    
                    <div className={`${styles.formGroup} ${coordinates ? styles.hasValue : ''}`}>
                      <label htmlFor="coordinates">COORDINATES (REQUIRED)</label>
                      <div className={styles.inputWrapper}>
                        <input 
                          type="text" 
                          id="coordinates" 
                          value={coordinates} 
                          onChange={(e) => {
                            setCoordinates(e.target.value);
                            if (e.target.value && validationError && validationError.includes('координат')) {
                              setValidationError('');
                            }
                          }} 
                          placeholder="XYZ" 
                          className={validationError && validationError.includes('координат') ? styles.inputError : ''}
                          disabled={reportStatus === 'sending'}
                        />
                        <div className={styles.placeholderExamples}>
                          Формат: X - xxx.xx  Y - xxx.xx  Z - xxxxx.xx
                        </div>
                        {coordinates && <span className={styles.inputIndicator}></span>}
                      </div>
                      <button 
                        type="button" 
                        className={styles.currentCoordsButton} 
                        onClick={() => {
                          fillCurrentCoordinates();
                          if (validationError && validationError.includes('координат')) {
                            setValidationError('');
                          }
                        }}
                        disabled={reportStatus === 'sending'}
                      >
                        <span className={styles.buttonIcon}>⊗</span> СИНХРОНИЗИРОВАТЬ ТЕКУЩИЕ КООРДИНАТЫ
                      </button>
                    </div>
                    
                    {validationError && (
                      <div className={styles.errorMessageContainer}>
                        <div className={styles.errorMessage}>{validationError}</div>
                      </div>
                    )}
                    
                    <div className={styles.formActions}>
                      <button 
                        type="submit" 
                        className={`${styles.submitButton} ${reportStatus === 'sending' ? styles.sending : ''}`}
                        disabled={reportStatus === 'sending'}
                      >
                        {reportStatus === 'sending' ? (
                          <>
                            <span className={styles.loadingDot}></span>
                            <span className={styles.loadingDot}></span>
                            <span className={styles.loadingDot}></span>
                            ОТПРАВКА...
                          </>
                        ) : 'ОТПРАВИТЬ ОТЧЕТ'}
                      </button>
                    </div>
                  </form>
                )}
              </div>
            </div>
          ) : activeTab === 'terminal' ? (
            <div className={styles.terminalContainer}>
              <div className={styles.terminalHeader}>
                <div className={styles.terminalTitle}>ADNOS CORE TERMINAL</div>
                <div className={styles.terminalControls}>
                  <div className={styles.terminalStatus}>ОПЕРАЦИОННЫЙ РЕЖИМ</div>
                  <div className={styles.terminalDot}></div>
                </div>
              </div>
              
              <div className={styles.terminalBody}>
                <div className={styles.terminalOutput} ref={terminalOutputRef}>
                  {terminalHistory.map((entry, index) => (
                    <div 
                      key={index}
                      className={`${styles.terminalLine} ${
                        entry.type === 'input' ? styles.terminalInput : 
                        entry.type === 'system' ? styles.terminalSystem : 
                        entry.type === 'n28' ? styles.terminalN28 : 
                        entry.type === 'isiris' ? styles.terminalIsiris : 
                        entry.type === 'n28-urgent' ? styles.terminalN28Urgent : 
                        entry.type === 'system-error' ? styles.terminalError : 
                        entry.type === 'connection-lost' ? styles.terminalConnectionLost : 
                        entry.type === 'progress' ? styles.terminalProgress : 
                        entry.type === 'coordinates' ? styles.terminalCoordinates : 
                        entry.type === 'warning' ? styles.terminalWarning : 
                        styles.terminalSystem
                      }`}
                    >
                      {entry.content}
                    </div>
                  ))}
                </div>
                
                <form className={styles.terminalInputContainer} onSubmit={handleTerminalSubmit}>
                  <span className={styles.terminalPrompt}>{'>'}</span>
                  <div className={styles.terminalInputWrapper}>
                    {suggestionVisible && terminalInput && (
                      <div className={styles.terminalSuggestion}>
                        {terminalInput}
                        <span className={styles.suggestionText}>
                          {terminalCommands.find(cmd => 
                            cmd.command.toUpperCase().startsWith(terminalInput.toUpperCase())
                          )?.command.slice(terminalInput.length) || ''}
                        </span>
                      </div>
                    )}
                    <input 
                      type="text" 
                      className={styles.terminalInputField}
                      value={terminalInput}
                      onChange={handleTerminalInputChange}
                      onKeyDown={handleTerminalKeyDown}
                      ref={terminalInputRef}
                      placeholder="Введите команду"
                      autoComplete="off"
                      spellCheck="false"
                      disabled={processingCommand}
                    />
                  </div>
                </form>
              </div>
            </div>
          ) : null}
        </div>
        
        <div className={styles.modalFooter}>
          <div className={styles.footerInfo}>
            LAST MAINTENANCE: 37.05.2184 | SOFTWARE VERSION: ADNOS OS 3.7.2
          </div>
          <button className={styles.closeModalBtn} onClick={() => {
            playCliSound();
            onClose();
          }}>CLOSE</button>
        </div>
      </div>
    </div>
  );
};

export default ShipInfoModal; 